<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0a0a0f">
<title>VAULT â€” Case Opener</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap');

:root {
â€“bg: #0a0a0f;
â€“surface: #12121a;
â€“surface2: #1a1a28;
â€“border: rgba(255,255,255,0.07);
â€“accent: #c8a84b;
â€“accent2: #e8c96a;
â€“text: #e8e8f0;
â€“muted: #6b6b88;
â€“red: #e84040;
â€“blue: #4080e8;
â€“purple: #9040e8;
â€“gold: #c8a84b;
â€“green: #40c870;
â€“cyan: #40c8c8;
}

- { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

html, body {
width: 100%; height: 100%;
background: #0a0a0f !important;
background-color: #0a0a0f !important;
color: #e8e8f0;
color: var(â€“text);
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
overflow: hidden;
-webkit-text-size-adjust: 100%;
}

/* â”€â”€ SCREENS â”€â”€ */
.screen { position: absolute; inset: 0; display: none; flex-direction: column; overflow: hidden; }
.screen.active { display: flex; }

/* â”€â”€ BACKGROUND GRID â”€â”€ */
body::before {
content: â€˜â€™;
position: fixed; inset: 0;
background-image:
linear-gradient(rgba(200,168,75,0.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(200,168,75,0.03) 1px, transparent 1px);
background-size: 40px 40px;
pointer-events: none;
z-index: 0;
}

/* â”€â”€ MAIN MENU â”€â”€ */
#screen-main {
align-items: center;
justify-content: space-between;
padding: 0;
z-index: 1;
}

.main-header {
width: 100%;
display: flex;
justify-content: space-between;
align-items: center;
padding: 16px 20px;
border-bottom: 1px solid var(â€“border);
background: rgba(18,18,26,0.9);
backdrop-filter: blur(10px);
flex-shrink: 0;
z-index: 2;
}

.logo {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-weight: 900;
font-size: 24px;
letter-spacing: 8px;
color: var(â€“accent);
text-shadow: 0 0 30px rgba(200,168,75,0.4);
}

.balance-chip {
display: flex;
align-items: center;
gap: 8px;
background: var(â€“surface2);
border: 1px solid var(â€“accent);
border-radius: 8px;
padding: 8px 16px;
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 14px;
font-weight: 700;
color: var(â€“accent2);
}

.balance-chip::before {
content: â€˜$â€™;
color: var(â€“muted);
font-size: 11px;
}

.main-hero {
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
gap: 8px;
padding: 20px;
position: relative;
}

.hero-glow {
position: absolute;
width: 300px; height: 300px;
border-radius: 50%;
background: radial-gradient(circle, rgba(200,168,75,0.08) 0%, transparent 70%);
pointer-events: none;
}

.hero-title {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 13px;
letter-spacing: 6px;
color: var(â€“muted);
text-transform: uppercase;
}

.hero-sub {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 36px;
font-weight: 900;
letter-spacing: 4px;
color: var(â€“text);
text-align: center;
}

.hero-sub span { color: var(â€“accent); }

.hero-case-preview {
width: 120px; height: 90px;
margin: 24px 0 16px;
position: relative;
display: flex;
align-items: center;
justify-content: center;
}

.case-box {
width: 100px; height: 75px;
background: linear-gradient(145deg, #1e1e30, #12121a);
border: 1px solid var(â€“accent);
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
font-size: 36px;
box-shadow: 0 0 40px rgba(200,168,75,0.15), inset 0 1px 0 rgba(255,255,255,0.05);
animation: caseFloat 3s ease-in-out infinite;
position: relative;
}

.case-box::before {
content: â€˜â€™;
position: absolute;
top: -1px; left: 10%; right: 10%; height: 1px;
background: linear-gradient(90deg, transparent, var(â€“accent2), transparent);
}

.case-box::after {
content: â€˜â€™;
position: absolute;
bottom: 0; left: 0; right: 0; height: 30%;
background: linear-gradient(180deg, transparent, rgba(200,168,75,0.04));
border-radius: 0 0 8px 8px;
}

@keyframes caseFloat {
0%, 100% { transform: translateY(0) rotateX(0deg); }
50% { transform: translateY(-8px) rotateX(3deg); }
}

.main-stats {
display: flex;
gap: 24px;
margin-bottom: 16px;
}

.stat { text-align: center; }
.stat-val {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 20px;
font-weight: 700;
color: var(â€“accent2);
}
.stat-label {
font-size: 11px;
letter-spacing: 2px;
color: var(â€“muted);
text-transform: uppercase;
}

.main-actions {
width: 100%;
padding: 16px 20px 32px;
display: flex;
flex-direction: column;
gap: 10px;
flex-shrink: 0;
}

.btn-primary {
width: 100%;
padding: 18px;
background: var(â€“accent);
color: #0a0a0f;
border: none;
border-radius: 8px;
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-weight: 700;
font-size: 14px;
letter-spacing: 3px;
cursor: pointer;
transition: all 0.15s;
text-transform: uppercase;
box-shadow: 0 4px 20px rgba(200,168,75,0.3);
}

.btn-primary:active { transform: scale(0.97); opacity: 0.9; }

.btn-secondary {
width: 100%;
padding: 14px;
background: transparent;
color: var(â€“text);
border: 1px solid var(â€“border);
border-radius: 8px;
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
font-weight: 600;
font-size: 15px;
letter-spacing: 2px;
cursor: pointer;
transition: all 0.15s;
text-transform: uppercase;
}
.btn-secondary:active { background: var(â€“surface2); }

.btn-ghost {
width: 100%;
padding: 12px;
background: transparent;
color: var(â€“muted);
border: 1px dashed rgba(255,255,255,0.1);
border-radius: 8px;
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
font-weight: 600;
font-size: 13px;
letter-spacing: 2px;
cursor: pointer;
transition: all 0.15s;
text-transform: uppercase;
}
.btn-ghost:active { color: var(â€“text); }

/* â”€â”€ CASE SELECT MODAL â”€â”€ */
.modal-overlay {
position: fixed; inset: 0;
background: rgba(0,0,0,0.75);
z-index: 100;
display: none;
align-items: flex-end;
justify-content: center;
backdrop-filter: blur(4px);
}
.modal-overlay.active { display: flex; }

.modal {
width: 100%; max-width: 500px;
background: var(â€“surface);
border-radius: 20px 20px 0 0;
border-top: 1px solid var(â€“border);
max-height: 85vh;
display: flex;
flex-direction: column;
animation: slideUp 0.35s cubic-bezier(0.16, 1, 0.3, 1) both;
}

@keyframes slideUp {
from { transform: translateY(100%); }
to { transform: translateY(0); }
}

.modal-handle {
width: 40px; height: 4px;
background: var(â€“border);
border-radius: 2px;
margin: 12px auto 0;
flex-shrink: 0;
}

.modal-head {
padding: 16px 20px 14px;
display: flex;
align-items: center;
justify-content: space-between;
border-bottom: 1px solid var(â€“border);
flex-shrink: 0;
}

.modal-title {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 13px;
letter-spacing: 4px;
color: var(â€“muted);
text-transform: uppercase;
}

.modal-close {
width: 32px; height: 32px;
background: var(â€“surface2);
border: 1px solid var(â€“border);
border-radius: 6px;
color: var(â€“muted);
font-size: 16px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
}

.modal-body { overflow-y: auto; padding: 16px; flex: 1; }

/* â”€â”€ CASE CARDS â”€â”€ */
.case-card {
background: var(â€“surface2);
border: 1px solid var(â€“border);
border-radius: 12px;
padding: 16px;
display: flex;
align-items: center;
gap: 16px;
margin-bottom: 10px;
cursor: pointer;
transition: all 0.2s;
position: relative;
overflow: hidden;
}

.case-card::before {
content: â€˜â€™;
position: absolute;
top: 0; left: 0; right: 0; height: 1px;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
}

.case-card:active { transform: scale(0.98); border-color: var(â€“accent); }

.case-card-icon {
width: 64px; height: 50px;
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
font-size: 28px;
flex-shrink: 0;
position: relative;
}

.case-card-info { flex: 1; min-width: 0; }
.case-card-name {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 12px;
font-weight: 700;
letter-spacing: 2px;
margin-bottom: 4px;
text-transform: uppercase;
}
.case-card-desc {
font-size: 13px;
color: var(â€“muted);
margin-bottom: 8px;
}
.case-card-footer {
display: flex;
align-items: center;
gap: 10px;
}

.price-tag {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 13px;
font-weight: 700;
}

.price-free { color: var(â€“green); }
.price-coins { color: var(â€“accent); }

.rarity-dots {
display: flex;
gap: 4px;
}

.rdot {
width: 6px; height: 6px;
border-radius: 50%;
}

.tier-badge {
position: absolute;
top: 8px; right: 8px;
font-size: 10px;
font-weight: 700;
letter-spacing: 1px;
padding: 3px 8px;
border-radius: 4px;
text-transform: uppercase;
}

/* â”€â”€ OPENING SCREEN â”€â”€ */
#screen-opening {
background: var(â€“bg);
z-index: 50;
overflow: hidden;
}

.opening-header {
display: flex;
align-items: center;
justify-content: space-between;
padding: 16px 20px;
border-bottom: 1px solid var(â€“border);
flex-shrink: 0;
}

.opening-case-name {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 11px;
letter-spacing: 4px;
color: var(â€“muted);
text-transform: uppercase;
}

.btn-back {
background: var(â€“surface2);
border: 1px solid var(â€“border);
color: var(â€“muted);
border-radius: 6px;
padding: 8px 14px;
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
font-weight: 700;
font-size: 13px;
letter-spacing: 2px;
cursor: pointer;
text-transform: uppercase;
}

/* ROULETTE */
.roulette-wrap {
width: 100%;
flex-shrink: 0;
position: relative;
margin: 24px 0;
overflow: hidden;
}

.roulette-track-outer {
width: 100%;
overflow: hidden;
position: relative;
}

.roulette-track-outer::before,
.roulette-track-outer::after {
content: â€˜â€™;
position: absolute;
top: 0; bottom: 0;
width: 80px;
z-index: 2;
pointer-events: none;
}
.roulette-track-outer::before {
left: 0;
background: linear-gradient(90deg, var(â€“bg), transparent);
}
.roulette-track-outer::after {
right: 0;
background: linear-gradient(-90deg, var(â€“bg), transparent);
}

/* Center line */
.roulette-indicator {
position: absolute;
left: 50%;
top: 0; bottom: 0;
width: 3px;
background: linear-gradient(180deg, transparent 0%, var(â€“accent) 20%, var(â€“accent) 80%, transparent 100%);
transform: translateX(-50%);
z-index: 3;
box-shadow: 0 0 16px var(â€“accent), 0 0 32px rgba(200,168,75,0.3);
}

/* Top arrow pointing DOWN */
.roulette-arrow-top {
position: absolute;
left: 50%;
top: -2px;
transform: translateX(-50%);
z-index: 10;
width: 0; height: 0;
border-left: 16px solid transparent;
border-right: 16px solid transparent;
border-top: 22px solid var(â€“accent);
filter: drop-shadow(0 0 8px var(â€“accent));
}

/* Bottom arrow pointing UP */
.roulette-arrow-bottom {
position: absolute;
left: 50%;
bottom: -2px;
transform: translateX(-50%);
z-index: 10;
width: 0; height: 0;
border-left: 16px solid transparent;
border-right: 16px solid transparent;
border-bottom: 22px solid var(â€“accent);
filter: drop-shadow(0 0 8px var(â€“accent));
}

/* Highlight box around selected item */
.roulette-selector-box {
position: absolute;
left: 50%;
top: 0; bottom: 0;
width: 108px;
transform: translateX(-50%);
z-index: 2;
border-left: 3px solid var(â€“accent);
border-right: 3px solid var(â€“accent);
background: rgba(200,168,75,0.05);
pointer-events: none;
}

.roulette-track {
display: flex;
gap: 8px;
padding: 12px 0;
transition: transform 8s cubic-bezier(0.05, 0.8, 0.3, 1);
will-change: transform;
}

.roulette-item {
width: 100px;
height: 110px;
border-radius: 10px;
flex-shrink: 0;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
gap: 4px;
border: 1px solid rgba(255,255,255,0.06);
position: relative;
overflow: hidden;
}

.roulette-item::before {
content: â€˜â€™;
position: absolute;
inset: 0;
background: linear-gradient(180deg, rgba(255,255,255,0.04) 0%, transparent 100%);
}

.ri-emoji { font-size: 34px; position: relative; z-index: 1; }

/* Winning item highlight */
.roulette-item.winner {
border: 2px solid var(â€“accent) !important;
box-shadow: 0 0 24px rgba(200,168,75,0.5), inset 0 0 20px rgba(200,168,75,0.08);
animation: winnerPulse 0.5s ease-out forwards;
}
@keyframes winnerPulse {
0%   { transform: scale(1); }
50%  { transform: scale(1.1); }
100% { transform: scale(1.05); }
}
.ri-name {
font-size: 9px;
font-weight: 700;
letter-spacing: 1px;
text-align: center;
color: rgba(255,255,255,0.7);
padding: 0 4px;
text-transform: uppercase;
position: relative; z-index: 1;
}
.ri-rarity {
font-size: 8px;
font-weight: 600;
padding: 2px 6px;
border-radius: 3px;
text-transform: uppercase;
letter-spacing: 1px;
position: relative; z-index: 1;
}

/* Opening center */
.opening-center {
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 20px;
gap: 16px;
position: relative;
}

.big-case {
width: 160px; height: 120px;
background: linear-gradient(145deg, var(â€“surface2), var(â€“surface));
border: 1px solid var(â€“accent);
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
font-size: 56px;
box-shadow: 0 0 60px rgba(200,168,75,0.15), inset 0 1px 0 rgba(255,255,255,0.05);
cursor: pointer;
animation: caseFloat 3s ease-in-out infinite;
transition: transform 0.15s;
position: relative;
overflow: hidden;
}

.big-case::before {
content: â€˜â€™;
position: absolute;
top: 0; left: 10%; right: 10%; height: 1px;
background: linear-gradient(90deg, transparent, var(â€“accent2), transparent);
}

.big-case:active { transform: scale(0.95) !important; animation: none; }

.open-hint {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 10px;
letter-spacing: 4px;
color: var(â€“muted);
animation: blink 1.5s ease-in-out infinite;
text-transform: uppercase;
}

@keyframes blink {
0%, 100% { opacity: 0.4; }
50% { opacity: 1; }
}

.opening-cost {
font-size: 13px;
color: var(â€“muted);
letter-spacing: 1px;
}

/* Result */
.result-card {
width: 100%;
max-width: 280px;
border-radius: 16px;
padding: 28px 20px;
display: flex;
flex-direction: column;
align-items: center;
gap: 10px;
position: relative;
overflow: hidden;
animation: resultPop 0.5s cubic-bezier(0.16, 1.3, 0.3, 1) both;
}

@keyframes resultPop {
from { opacity: 0; transform: scale(0.5); }
to { opacity: 1; transform: scale(1); }
}

.result-card::before {
content: â€˜â€™;
position: absolute;
inset: 0;
background: linear-gradient(180deg, rgba(255,255,255,0.08) 0%, transparent 60%);
}

.result-emoji {
font-size: 72px;
position: relative;
z-index: 1;
filter: drop-shadow(0 4px 20px rgba(0,0,0,0.5));
}

.result-name {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 16px;
font-weight: 700;
letter-spacing: 2px;
color: #fff;
text-align: center;
position: relative; z-index: 1;
text-transform: uppercase;
}

.result-rarity-badge {
font-size: 11px;
font-weight: 700;
letter-spacing: 2px;
padding: 4px 12px;
border-radius: 4px;
text-transform: uppercase;
position: relative; z-index: 1;
}

.result-value {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 18px;
font-weight: 700;
color: var(â€“accent2);
position: relative; z-index: 1;
}

.result-desc {
font-size: 13px;
color: rgba(255,255,255,0.5);
text-align: center;
position: relative; z-index: 1;
max-width: 200px;
}

.result-coins-earned {
font-size: 14px;
color: var(â€“green);
font-weight: 700;
letter-spacing: 1px;
}

.result-actions {
display: flex;
gap: 10px;
width: 100%;
max-width: 320px;
}

.btn-again {
flex: 1;
padding: 16px;
background: var(â€“accent);
color: #0a0a0f;
border: none;
border-radius: 8px;
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-weight: 700;
font-size: 11px;
letter-spacing: 3px;
cursor: pointer;
transition: all 0.15s;
text-transform: uppercase;
box-shadow: 0 4px 20px rgba(200,168,75,0.3);
}
.btn-again:active { transform: scale(0.96); }

.btn-menu {
padding: 16px 20px;
background: transparent;
color: var(â€“muted);
border: 1px solid var(â€“border);
border-radius: 8px;
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
font-weight: 700;
font-size: 13px;
letter-spacing: 2px;
cursor: pointer;
transition: all 0.15s;
text-transform: uppercase;
}

/* â”€â”€ INVENTORY â”€â”€ */
#screen-inventory {
z-index: 1;
background: var(â€“bg);
}

.inv-header {
display: flex;
align-items: center;
justify-content: space-between;
padding: 16px 20px;
border-bottom: 1px solid var(â€“border);
flex-shrink: 0;
}

.inv-title {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 13px;
letter-spacing: 4px;
color: var(â€“muted);
text-transform: uppercase;
}

.filter-row {
display: flex;
gap: 8px;
padding: 12px 16px;
overflow-x: auto;
flex-shrink: 0;
border-bottom: 1px solid var(â€“border);
scrollbar-width: none;
}
.filter-row::-webkit-scrollbar { display: none; }

.filter-chip {
padding: 6px 14px;
border-radius: 4px;
background: var(â€“surface2);
border: 1px solid var(â€“border);
color: var(â€“muted);
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
font-weight: 700;
font-size: 12px;
letter-spacing: 2px;
cursor: pointer;
text-transform: uppercase;
flex-shrink: 0;
transition: all 0.15s;
}
.filter-chip.active {
border-color: var(â€“accent);
color: var(â€“accent);
background: rgba(200,168,75,0.08);
}

.inv-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 8px;
padding: 12px;
overflow-y: auto;
flex: 1;
}

.inv-item {
aspect-ratio: 0.8;
border-radius: 10px;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
gap: 4px;
border: 1px solid rgba(255,255,255,0.06);
cursor: pointer;
transition: transform 0.15s;
position: relative;
overflow: hidden;
padding: 8px 4px;
}
.inv-item::before {
content: â€˜â€™;
position: absolute;
top: 0; left: 0; right: 0;
height: 40%;
background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 100%);
}
.inv-item:active { transform: scale(0.94); }

.inv-emoji { font-size: 28px; position: relative; z-index: 1; }
.inv-name {
font-size: 9px;
font-weight: 700;
letter-spacing: 1px;
text-align: center;
color: rgba(255,255,255,0.8);
text-transform: uppercase;
position: relative; z-index: 1;
padding: 0 2px;
}
.inv-count {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 9px;
color: rgba(255,255,255,0.4);
position: relative; z-index: 1;
}

.inv-empty {
grid-column: 1/-1;
text-align: center;
padding: 60px 20px;
color: var(â€“muted);
}
.inv-empty-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.3; }
.inv-empty-text { font-size: 14px; letter-spacing: 2px; text-transform: uppercase; }

/* â”€â”€ ITEM DETAIL â”€â”€ */
.detail-overlay {
position: fixed; inset: 0;
background: rgba(0,0,0,0.8);
z-index: 500;
display: none;
align-items: center;
justify-content: center;
backdrop-filter: blur(8px);
}
.detail-overlay.active { display: flex; }

.detail-card {
width: 85%; max-width: 320px;
border-radius: 20px;
padding: 32px 24px;
display: flex;
flex-direction: column;
align-items: center;
gap: 12px;
animation: resultPop 0.3s cubic-bezier(0.16, 1.3, 0.3, 1) both;
position: relative;
overflow: hidden;
}
.detail-card::before {
content: â€˜â€™;
position: absolute;
top: 0; left: 0; right: 0; height: 60%;
background: linear-gradient(180deg, rgba(255,255,255,0.07) 0%, transparent 100%);
}
.detail-card::after {
content: â€˜â€™;
position: absolute;
top: 0; left: 10%; right: 10%; height: 1px;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
}

.detail-close {
position: absolute;
top: 14px; right: 14px;
width: 30px; height: 30px;
background: rgba(0,0,0,0.3);
border: 1px solid rgba(255,255,255,0.1);
border-radius: 6px;
color: rgba(255,255,255,0.6);
font-size: 14px;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
}

.detail-emoji { font-size: 80px; position: relative; z-index: 1; }
.detail-name {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 15px;
font-weight: 700;
letter-spacing: 2px;
color: #fff;
text-align: center;
text-transform: uppercase;
position: relative; z-index: 1;
}
.detail-rarity-badge {
font-size: 10px;
font-weight: 700;
letter-spacing: 2px;
padding: 4px 12px;
border-radius: 4px;
text-transform: uppercase;
position: relative; z-index: 1;
}
.detail-desc {
font-size: 13px;
color: rgba(255,255,255,0.5);
text-align: center;
line-height: 1.5;
position: relative; z-index: 1;
}
.detail-value {
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 20px;
font-weight: 700;
color: var(â€“accent2);
position: relative; z-index: 1;
}
.detail-owned {
font-size: 12px;
color: rgba(255,255,255,0.35);
letter-spacing: 2px;
text-transform: uppercase;
position: relative; z-index: 1;
}

/* â”€â”€ CODE MODAL â”€â”€ */
.code-section { padding: 16px; }
.code-label {
font-size: 12px;
letter-spacing: 2px;
color: var(â€“muted);
text-transform: uppercase;
margin-bottom: 10px;
}
.code-input {
width: 100%;
background: var(â€“surface2);
border: 1px solid var(â€“border);
border-radius: 8px;
padding: 14px 16px;
color: var(â€“text);
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 14px;
font-weight: 700;
letter-spacing: 3px;
text-transform: uppercase;
outline: none;
transition: border-color 0.2s;
}
.code-input:focus { border-color: var(â€“accent); }
.code-input::placeholder { color: var(â€“muted); letter-spacing: 2px; font-size: 11px; }

.btn-redeem {
width: 100%;
margin-top: 10px;
padding: 14px;
background: var(â€“accent);
color: #0a0a0f;
border: none;
border-radius: 8px;
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-weight: 700;
font-size: 12px;
letter-spacing: 3px;
cursor: pointer;
text-transform: uppercase;
}

.code-result {
margin-top: 10px;
padding: 12px;
border-radius: 8px;
font-size: 13px;
font-weight: 700;
display: none;
letter-spacing: 1px;
}
.code-result.success { background: rgba(64,200,112,0.1); border: 1px solid var(â€“green); color: var(â€“green); display: block; }
.code-result.error { background: rgba(232,64,64,0.1); border: 1px solid var(â€“red); color: var(â€“red); display: block; }

.codes-hint {
margin-top: 16px;
padding: 14px;
background: var(â€“surface2);
border: 1px solid var(â€“border);
border-radius: 8px;
font-size: 12px;
color: var(â€“muted);
line-height: 1.7;
}
.codes-hint strong { color: var(â€“accent); letter-spacing: 1px; }

/* â”€â”€ TOAST â”€â”€ */
.toast {
position: fixed;
bottom: 30px; left: 50%;
transform: translateX(-50%) translateY(80px);
background: var(â€“surface);
border: 1px solid var(â€“accent);
color: var(â€“text);
padding: 12px 24px;
border-radius: 8px;
font-family: â€˜Orbitronâ€™, â€˜Courier Newâ€™, monospace;
font-size: 11px;
letter-spacing: 2px;
z-index: 9999;
transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
white-space: nowrap;
box-shadow: 0 8px 30px rgba(0,0,0,0.4);
text-transform: uppercase;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* â”€â”€ SHINE FLASH â”€â”€ */
.shine-flash {
position: fixed; inset: 0;
z-index: 9998;
pointer-events: none;
animation: shineOut 1.2s ease-out forwards;
}
@keyframes shineOut {
0% { opacity: 1; }
100% { opacity: 0; }
}

/* RARITY COLOR UTILITY CLASSES */
.r-common    { background: linear-gradient(135deg, #2a2a38, #1e1e2a); }
.r-uncommon  { background: linear-gradient(135deg, #0e2a18, #1a3a28); }
.r-rare      { background: linear-gradient(135deg, #0e1a38, #1a2a52); }
.r-epic      { background: linear-gradient(135deg, #1e0e38, #2e1a52); }
.r-legendary { background: linear-gradient(135deg, #281805, #3d2808); }
.r-mythical  { background: linear-gradient(135deg, #280528, #3d0a3d); }
.r-contraband{ background: linear-gradient(135deg, #280505, #500808); }

.badge-common    { background: rgba(120,120,140,0.2); color: #8888a8; }
.badge-uncommon  { background: rgba(64,200,112,0.15); color: var(â€“green); }
.badge-rare      { background: rgba(64,128,232,0.15); color: var(â€“blue); }
.badge-epic      { background: rgba(144,64,232,0.15); color: var(â€“purple); }
.badge-legendary { background: rgba(200,168,75,0.15); color: var(â€“accent2); }
.badge-mythical  { background: rgba(200,64,200,0.15); color: #e040e0; }
.badge-contraband{ background: rgba(232,64,64,0.15); color: var(â€“red); }

/* nav bar */
.nav-bar {
display: flex;
border-top: 1px solid var(â€“border);
flex-shrink: 0;
background: var(â€“surface);
}

.nav-btn {
flex: 1;
padding: 14px 8px;
background: none;
border: none;
color: var(â€“muted);
cursor: pointer;
display: flex;
flex-direction: column;
align-items: center;
gap: 4px;
transition: color 0.15s;
font-family: â€˜Rajdhaniâ€™, â€˜Trebuchet MSâ€™, Arial, sans-serif;
font-weight: 700;
font-size: 10px;
letter-spacing: 1px;
text-transform: uppercase;
}
.nav-btn.active { color: var(â€“accent); }
.nav-icon { font-size: 20px; line-height: 1; }

/* Particle effect */
.particles { position: fixed; inset: 0; pointer-events: none; z-index: 9997; }
.particle {
position: absolute;
border-radius: 50%;
pointer-events: none;
animation: particleFly 1.5s ease-out forwards;
}
@keyframes particleFly {
0% { opacity: 1; transform: translate(0,0) scale(1); }
100% { opacity: 0; transform: translate(var(â€“tx), var(â€“ty)) scale(0); }
}
</style>

</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="screen active" id="screen-main">
  <div class="main-header">
    <div class="logo">VAULT</div>
    <div class="balance-chip" id="balanceDisplay">0</div>
  </div>

  <div class="main-hero">
    <div class="hero-glow"></div>
    <div class="hero-title">Premium</div>
    <div class="hero-sub">CASE<br><span>OPENER</span></div>
    <div class="hero-case-preview">
      <div class="case-box">ğŸ</div>
    </div>
    <div class="main-stats">
      <div class="stat">
        <div class="stat-val" id="statOpened">0</div>
        <div class="stat-label">Opened</div>
      </div>
      <div class="stat">
        <div class="stat-val" id="statUnique">0</div>
        <div class="stat-label">Unique</div>
      </div>
      <div class="stat">
        <div class="stat-val" id="statRarest">â€”</div>
        <div class="stat-label">Best Drop</div>
      </div>
    </div>
  </div>

  <div class="main-actions">
    <button class="btn-primary" id="btnOpenCase">OPEN A CASE</button>
    <button class="btn-secondary" id="btnViewInventory">INVENTORY</button>
    <div style="display:flex;gap:10px;">
      <button class="btn-ghost" style="flex:1;" id="btnCode">REDEEM CODE</button>
      <button class="btn-ghost" style="flex:1;" id="btnReset">RESET</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• OPENING SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="screen" id="screen-opening">
  <div class="opening-header">
    <button class="btn-back" id="btnBackOpening">â† BACK</button>
    <div class="opening-case-name" id="openingCaseName">CASE</div>
    <div style="font-family:'Orbitron',monospace;font-size:11px;color:var(--accent);" id="openingBalance">$0</div>
  </div>
  <div class="opening-center" id="openingCenter"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• INVENTORY SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="screen" id="screen-inventory">
  <div class="inv-header">
    <button class="btn-back" id="btnBackInventory">â† BACK</button>
    <div class="inv-title">INVENTORY</div>
    <div style="font-family:'Orbitron',monospace;font-size:11px;color:var(--accent);" id="invBalance">$0</div>
  </div>

  <div class="filter-row" id="filterRow">
    <button class="filter-chip active" data-filter="all">ALL</button>
    <button class="filter-chip" data-filter="contraband">CONTRABAND</button>
    <button class="filter-chip" data-filter="mythical">MYTHICAL</button>
    <button class="filter-chip" data-filter="legendary">LEGENDARY</button>
    <button class="filter-chip" data-filter="epic">EPIC</button>
    <button class="filter-chip" data-filter="rare">RARE</button>
    <button class="filter-chip" data-filter="uncommon">UNCOMMON</button>
    <button class="filter-chip" data-filter="common">COMMON</button>
  </div>

  <div class="inv-grid" id="invGrid"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• CASE SELECT MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="modal-overlay" id="modalCases">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-head">
      <div class="modal-title">SELECT CASE</div>
      <button class="modal-close" id="btnCloseCases">âœ•</button>
    </div>
    <div class="modal-body" id="caseListBody"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• CODE MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="modal-overlay" id="modalCode">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-head">
      <div class="modal-title">REDEEM CODE</div>
      <button class="modal-close" id="btnCloseCode">âœ•</button>
    </div>
    <div class="code-section">
      <div class="code-label">Enter promo code</div>
      <input type="text" class="code-input" id="codeInput" placeholder="TYPE CODE HERE" maxlength="20">
      <button class="btn-redeem" id="btnRedeem">REDEEM</button>
      <div class="code-result" id="codeResult"></div>
      <div class="codes-hint">
        ğŸ’¡ Hint â€” try these codes:<br>
        <strong>VAULT100</strong> Â· <strong>WELCOME</strong> Â· <strong>FREECASE</strong> Â· <strong>GOLDKEY</strong>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ITEM DETAIL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="detail-overlay" id="detailOverlay">
  <div class="detail-card" id="detailCard">
    <button class="detail-close" id="btnCloseDetail">âœ•</button>
    <div class="detail-emoji" id="detailEmoji">â“</div>
    <div class="detail-name" id="detailName">ITEM</div>
    <div class="detail-rarity-badge" id="detailBadge">COMMON</div>
    <div class="detail-desc" id="detailDesc">Description</div>
    <div class="detail-value" id="detailValue">$0</div>
    <div class="detail-owned" id="detailOwned">Ã—1 OWNED</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA â€” ITEMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ITEMS = {
  // COMMON
  c001: { name:'Worn Wrench',    emoji:'ğŸ”§', rarity:'common',    value:10,  desc:'A basic utility tool. Found everywhere.' },
  c002: { name:'Cracked Mug',    emoji:'â˜•', rarity:'common',    value:8,   desc:'Still holds coffee. Mostly.' },
  c003: { name:'Paperclip',      emoji:'ğŸ“', rarity:'common',    value:5,   desc:'One of millions. Nothing special.' },
  c004: { name:'Rubber Duck',    emoji:'ğŸ¦†', rarity:'common',    value:12,  desc:'Debug companion. Battle-tested.' },
  c005: { name:'Sticky Note',    emoji:'ğŸ“', rarity:'common',    value:7,   desc:'Someone left a reminder: "don\'t forget".' },
  c006: { name:'Lost Penny',     emoji:'ğŸª™', rarity:'common',    value:6,   desc:'From 1987. Barely worth its weight.' },
  c007: { name:'Tape Roll',      emoji:'ğŸ§»', rarity:'common',    value:9,   desc:'Fixes everything. Eventually.' },
  c008: { name:'Bus Ticket',     emoji:'ğŸ«', rarity:'common',    value:11,  desc:'Expired. Route unknown.' },

  // UNCOMMON
  u001: { name:'Vintage Lighter', emoji:'ğŸ”¥', rarity:'uncommon',  value:50,  desc:'Brass finish. Still sparks.' },
  u002: { name:'Jade Earring',    emoji:'ğŸ’š', rarity:'uncommon',  value:65,  desc:'One of a pair. The other is missing.' },
  u003: { name:'Lucky Coin',      emoji:'ğŸ¥‡', rarity:'uncommon',  value:80,  desc:'Worn smooth from years of rubbing.' },
  u004: { name:'Compass',         emoji:'ğŸ§­', rarity:'uncommon',  value:70,  desc:'Always finds north. Occasionally.' },
  u005: { name:'Glass Vial',      emoji:'ğŸ§ª', rarity:'uncommon',  value:55,  desc:'Empty. But it glows faintly.' },
  u006: { name:'Pocket Watch',    emoji:'âŒš', rarity:'uncommon',  value:90,  desc:'Stopped at 3:47. Nobody knows why.' },

  // RARE
  r001: { name:'Obsidian Blade',  emoji:'ğŸ—¡ï¸', rarity:'rare',      value:250, desc:'Sharper than it looks. Ancient origin.' },
  r002: { name:'Storm Lantern',   emoji:'ğŸ®', rarity:'rare',      value:300, desc:'Burns without fuel. Somehow.' },
  r003: { name:'Navigator\'s Map',emoji:'ğŸ—ºï¸', rarity:'rare',      value:280, desc:'Shows places that shouldn\'t exist.' },
  r004: { name:'Crystal Lens',    emoji:'ğŸ”­', rarity:'rare',      value:350, desc:'Reveals things hidden to the naked eye.' },
  r005: { name:'Sealed Letter',   emoji:'ğŸ“œ', rarity:'rare',      value:220, desc:'From someone important. Unopened.' },
  r006: { name:'Mechanical Heart',emoji:'âš™ï¸', rarity:'rare',      value:400, desc:'Ticks on its own. No battery.' },

  // EPIC
  e001: { name:'Dragon Scale',    emoji:'ğŸ‰', rarity:'epic',      value:900, desc:'Shed willingly. Or taken. Hard to say.' },
  e002: { name:'Void Prism',      emoji:'ğŸ”®', rarity:'epic',      value:850, desc:'Bends light in directions light doesn\'t go.' },
  e003: { name:'Thunderstone',    emoji:'âš¡', rarity:'epic',      value:1000,desc:'Crackling with contained energy.' },
  e004: { name:'Silver Sigil',    emoji:'ğŸŒ™', rarity:'epic',      value:950, desc:'Marks its owner. Can\'t be removed.' },

  // LEGENDARY
  l001: { name:'Crown Jewel',     emoji:'ğŸ’', rarity:'legendary', value:3000,desc:'One of seven. Six are unaccounted for.' },
  l002: { name:'Phoenix Feather', emoji:'ğŸ¦…', rarity:'legendary', value:2500,desc:'Still warm to the touch. Always.' },
  l003: { name:'Temporal Key',    emoji:'ğŸ—ï¸', rarity:'legendary', value:4000,desc:'Opens a door that hasn\'t been built yet.' },

  // MYTHICAL
  m001: { name:'Starborn Core',   emoji:'â­', rarity:'mythical',  value:8000,desc:'Collapsed from a dying star. Still alive.' },
  m002: { name:'Infinity Loop',   emoji:'â™¾ï¸', rarity:'mythical',  value:9500,desc:'Has no beginning. Has no end. Somehow weighs something.' },

  // CONTRABAND
  x001: { name:'The Artifact',    emoji:'ğŸŒ‘', rarity:'contraband',value:25000,desc:'No classification exists for this. It shouldn\'t be here.' },
};

const RARITY_ORDER = ['common','uncommon','rare','epic','legendary','mythical','contraband'];
const RARITY_WEIGHT = { common:45, uncommon:25, rare:15, epic:8, legendary:4, mythical:2, contraband:0.5 };

// â”€â”€ CASES â”€â”€
const CASES = [
  {
    id:'starter',
    name:'STARTER CASE',
    emoji:'ğŸ“¦',
    desc:'Common & Uncommon drops only',
    cost:0,
    gradient:['#2a2a40','#1a1a2e'],
    accentColor:'#8888aa',
    tier:'FREE',
    tierColor:'var(--green)',
    pool: Object.entries(ITEMS).filter(([,v])=>['common','uncommon'].includes(v.rarity)).map(([k])=>k),
    dotColors:['#8888a8','#40c870'],
  },
  {
    id:'standard',
    name:'STANDARD CASE',
    emoji:'ğŸ',
    desc:'Uncommon through Rare drops',
    cost:100,
    gradient:['#0e2040','#0a1828'],
    accentColor:'var(--blue)',
    tier:'STANDARD',
    tierColor:'var(--blue)',
    pool: Object.entries(ITEMS).filter(([,v])=>['uncommon','rare'].includes(v.rarity)).map(([k])=>k),
    dotColors:['#40c870','#4080e8'],
  },
  {
    id:'premium',
    name:'PREMIUM CASE',
    emoji:'ğŸ’¼',
    desc:'Rare through Epic drops',
    cost:350,
    gradient:['#1e0e40','#160b30'],
    accentColor:'var(--purple)',
    tier:'PREMIUM',
    tierColor:'var(--purple)',
    pool: Object.entries(ITEMS).filter(([,v])=>['rare','epic'].includes(v.rarity)).map(([k])=>k),
    dotColors:['#4080e8','#9040e8'],
  },
  {
    id:'elite',
    name:'ELITE CASE',
    emoji:'ğŸ‘‘',
    desc:'Epic through Legendary drops',
    cost:1000,
    gradient:['#281800','#1e1000'],
    accentColor:'var(--gold)',
    tier:'ELITE',
    tierColor:'var(--gold)',
    pool: Object.entries(ITEMS).filter(([,v])=>['epic','legendary'].includes(v.rarity)).map(([k])=>k),
    dotColors:['#9040e8','#c8a84b'],
  },
  {
    id:'mythic',
    name:'MYTHIC CASE',
    emoji:'ğŸŒŒ',
    desc:'Legendary through Mythical drops',
    cost:3000,
    gradient:['#1e0028','#130018'],
    accentColor:'#e040e0',
    tier:'MYTHIC',
    tierColor:'#e040e0',
    pool: Object.entries(ITEMS).filter(([,v])=>['legendary','mythical'].includes(v.rarity)).map(([k])=>k),
    dotColors:['#c8a84b','#e040e0'],
  },
  {
    id:'contraband',
    name:'CONTRABAND CASE',
    emoji:'âš ï¸',
    desc:'All rarities â€” Contraband chance inside',
    cost:5000,
    gradient:['#280000','#1a0000'],
    accentColor:'var(--red)',
    tier:'CONTRABAND',
    tierColor:'var(--red)',
    pool: Object.keys(ITEMS),
    dotColors:['#8888a8','#40c870','#4080e8','#9040e8','#c8a84b','#e040e0','#e84040'],
  },
];

// â”€â”€ RARITY STYLES â”€â”€
const RARITY_STYLE = {
  common:     { bg:'r-common',    badge:'badge-common',    glow:'rgba(136,136,168,0.3)',  label:'COMMON' },
  uncommon:   { bg:'r-uncommon',  badge:'badge-uncommon',  glow:'rgba(64,200,112,0.3)',   label:'UNCOMMON' },
  rare:       { bg:'r-rare',      badge:'badge-rare',      glow:'rgba(64,128,232,0.3)',   label:'RARE' },
  epic:       { bg:'r-epic',      badge:'badge-epic',      glow:'rgba(144,64,232,0.3)',   label:'EPIC' },
  legendary:  { bg:'r-legendary', badge:'badge-legendary', glow:'rgba(200,168,75,0.3)',   label:'LEGENDARY' },
  mythical:   { bg:'r-mythical',  badge:'badge-mythical',  glow:'rgba(200,64,200,0.35)',  label:'MYTHICAL' },
  contraband: { bg:'r-contraband',badge:'badge-contraband',glow:'rgba(232,64,64,0.35)',   label:'CONTRABAND' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CODES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CODES_DB = {
  'VAULT100':  { type:'coins', amount:100 },
  'WELCOME':   { type:'coins', amount:250 },
  'FREECASE':  { type:'coins', amount:500 },
  'GOLDKEY':   { type:'coins', amount:1000 },
  'MEGA2025':  { type:'coins', amount:2000 },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let G = { coins:150, inventory:{}, casesOpened:0, region:'all' };
let activeCaseId = null;
const usedCodes = new Set();

function saveG() {
  try { localStorage.setItem('vault_g', JSON.stringify(G)); } catch(e) {}
}
function loadG() {
  try {
    const s = localStorage.getItem('vault_g');
    if (s) G = { ...G, ...JSON.parse(s) };
    const c = localStorage.getItem('vault_codes');
    if (c) JSON.parse(c).forEach(x => usedCodes.add(x));
  } catch(e) {}
}
function saveCodes() {
  try { localStorage.setItem('vault_codes', JSON.stringify([...usedCodes])); } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function refreshBalance() {
  const f = '$' + G.coins.toLocaleString();
  document.getElementById('balanceDisplay').textContent = G.coins.toLocaleString();
  document.getElementById('openingBalance').textContent = f;
  document.getElementById('invBalance').textContent = f;
}

function refreshStats() {
  const owned = Object.keys(G.inventory);
  document.getElementById('statOpened').textContent = G.casesOpened || 0;
  document.getElementById('statUnique').textContent = owned.length;

  // Best rarity
  let best = null;
  owned.forEach(k => {
    const item = ITEMS[k];
    if (!item) return;
    if (!best || RARITY_ORDER.indexOf(item.rarity) > RARITY_ORDER.indexOf(ITEMS[best]?.rarity)) best = k;
  });
  const bestEl = document.getElementById('statRarest');
  bestEl.textContent = best ? RARITY_STYLE[ITEMS[best].rarity].label.slice(0,3) : 'â€”';
}

let toastTimer = null;
function toast(msg) {
  clearTimeout(toastTimer);
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  toastTimer = setTimeout(() => el.classList.remove('show'), 2500);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CASE LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildCaseList() {
  const body = document.getElementById('caseListBody');
  body.innerHTML = '';
  CASES.forEach(c => {
    const card = document.createElement('div');
    card.className = 'case-card';
    card.innerHTML = `
      <div class="tier-badge" style="background:rgba(0,0,0,0.4);color:${c.tierColor};border:1px solid ${c.tierColor};">${c.tier}</div>
      <div class="case-card-icon" style="background:linear-gradient(135deg,${c.gradient[0]},${c.gradient[1]});border:1px solid ${c.accentColor}33;">
        <span style="font-size:28px;">${c.emoji}</span>
      </div>
      <div class="case-card-info">
        <div class="case-card-name" style="color:${c.accentColor};">${c.name}</div>
        <div class="case-card-desc">${c.desc}</div>
        <div class="case-card-footer">
          <span class="${c.cost===0?'price-free':'price-coins'}" style="font-family:'Orbitron',monospace;font-size:12px;font-weight:700;">
            ${c.cost===0?'FREE':'ğŸ”‘ $'+c.cost.toLocaleString()}
          </span>
          <div class="rarity-dots">
            ${c.dotColors.map(col=>`<div class="rdot" style="background:${col};"></div>`).join('')}
          </div>
        </div>
      </div>
    `;
    card.addEventListener('click', () => {
      closeModal('modalCases');
      startCase(c.id);
    });
    body.appendChild(card);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEIGHTED DRAW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function weightedDraw(pool) {
  const entries = pool.map(k => ({ key:k, item:ITEMS[k] })).filter(x => x.item);
  const total = entries.reduce((s,e) => s + (RARITY_WEIGHT[e.item.rarity] || 1), 0);
  let r = Math.random() * total;
  for (const e of entries) {
    r -= (RARITY_WEIGHT[e.item.rarity] || 1);
    if (r <= 0) return e.key;
  }
  return entries[entries.length - 1].key;
}

// Build roulette pool (45 items, result at index 35)
function buildRoulette(pool, resultKey) {
  const items = [];
  for (let i = 0; i < 45; i++) {
    items.push(weightedDraw(pool));
  }
  items[35] = resultKey;
  return items;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CASE OPENING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startCase(caseId) {
  const caseData = CASES.find(c => c.id === caseId);
  if (!caseData) return;

  if (caseData.cost > 0 && G.coins < caseData.cost) {
    toast('âš  NOT ENOUGH COINS');
    return;
  }
  if (caseData.cost > 0) {
    G.coins -= caseData.cost;
    saveG();
    refreshBalance();
  }

  activeCaseId = caseId;
  document.getElementById('openingCaseName').textContent = caseData.name;
  showScreen('screen-opening');
  buildCaseReadyView(caseData);
}

function buildCaseReadyView(caseData) {
  const center = document.getElementById('openingCenter');
  center.innerHTML = '';

  const caseBtn = document.createElement('button');
  caseBtn.className = 'big-case';
  caseBtn.innerHTML = caseData.emoji;
  caseBtn.style.borderColor = caseData.accentColor;
  caseBtn.style.boxShadow = `0 0 60px ${caseData.accentColor}22, inset 0 1px 0 rgba(255,255,255,0.05)`;

  const hint = document.createElement('div');
  hint.className = 'open-hint';
  hint.textContent = 'TAP TO OPEN';

  const costInfo = document.createElement('div');
  costInfo.className = 'opening-cost';
  costInfo.textContent = caseData.cost > 0 ? `Cost: $${caseData.cost.toLocaleString()}` : 'FREE CASE';

  center.appendChild(caseBtn);
  center.appendChild(hint);
  center.appendChild(costInfo);

  caseBtn.addEventListener('click', () => doRoulette(caseData), { once: true });
}

function doRoulette(caseData) {
  const resultKey = weightedDraw(caseData.pool);
  const resultItem = ITEMS[resultKey];
  if (!resultItem) return;

  const rouletteKeys = buildRoulette(caseData.pool, resultKey);

  const center = document.getElementById('openingCenter');
  center.innerHTML = '';

  const ITEM_W = 110; // item width
  const ITEM_GAP = 8;
  const CELL = ITEM_W + ITEM_GAP; // 118px per cell
  const WIN_IDX = 35;

  // â”€â”€ Build DOM â”€â”€
  const wrapper = document.createElement('div');
  wrapper.style.cssText = `
    width: 100%;
    position: relative;
    flex-shrink: 0;
  `;

  // Top arrow
  const arrowTop = document.createElement('div');
  arrowTop.style.cssText = `
    position: absolute;
    left: 50%; top: -4px;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-top: 24px solid #c8a84b;
    filter: drop-shadow(0 0 8px #c8a84b);
    z-index: 10;
    pointer-events: none;
  `;

  // Bottom arrow
  const arrowBottom = document.createElement('div');
  arrowBottom.style.cssText = `
    position: absolute;
    left: 50%; bottom: -4px;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-bottom: 24px solid #c8a84b;
    filter: drop-shadow(0 0 8px #c8a84b);
    z-index: 10;
    pointer-events: none;
  `;

  // Outer clip container
  const outer = document.createElement('div');
  outer.style.cssText = `
    width: 100%;
    overflow: hidden;
    position: relative;
    height: 150px;
  `;

  // Gold side lines at center
  const lineLeft = document.createElement('div');
  lineLeft.style.cssText = `
    position: absolute;
    left: calc(50% - ${ITEM_W/2 + 2}px);
    top: 0; bottom: 0; width: 3px;
    background: #c8a84b;
    box-shadow: 0 0 12px #c8a84b;
    z-index: 5; pointer-events: none;
  `;
  const lineRight = document.createElement('div');
  lineRight.style.cssText = `
    position: absolute;
    left: calc(50% + ${ITEM_W/2 - 1}px);
    top: 0; bottom: 0; width: 3px;
    background: #c8a84b;
    box-shadow: 0 0 12px #c8a84b;
    z-index: 5; pointer-events: none;
  `;

  // Fade edges
  const fadeLeft = document.createElement('div');
  fadeLeft.style.cssText = `position:absolute;left:0;top:0;bottom:0;width:90px;background:linear-gradient(90deg,#0a0a0f,transparent);z-index:4;pointer-events:none;`;
  const fadeRight = document.createElement('div');
  fadeRight.style.cssText = `position:absolute;right:0;top:0;bottom:0;width:90px;background:linear-gradient(-90deg,#0a0a0f,transparent);z-index:4;pointer-events:none;`;

  // Track
  const track = document.createElement('div');
  track.style.cssText = `
    display: flex;
    gap: ${ITEM_GAP}px;
    padding: 10px 0;
    will-change: transform;
    position: relative;
  `;

  rouletteKeys.forEach(k => {
    const item = ITEMS[k];
    if (!item) return;
    const rs = RARITY_STYLE[item.rarity] || RARITY_STYLE.common;
    const el = document.createElement('div');
    el.className = 'roulette-item ' + rs.bg;
    el.style.width = ITEM_W + 'px';
    el.innerHTML = `
      <div class="ri-emoji">${item.emoji}</div>
      <div class="ri-name">${item.name}</div>
      <div class="ri-rarity ${rs.badge}">${rs.label}</div>
    `;
    track.appendChild(el);
  });

  outer.appendChild(fadeLeft);
  outer.appendChild(fadeRight);
  outer.appendChild(lineLeft);
  outer.appendChild(lineRight);
  outer.appendChild(track);

  wrapper.appendChild(arrowTop);
  wrapper.appendChild(outer);
  wrapper.appendChild(arrowBottom);
  center.appendChild(wrapper);

  // â”€â”€ Centering math â”€â”€
  // After layout, get the actual container width
  requestAnimationFrame(() => {
    const containerW = outer.getBoundingClientRect().width || window.innerWidth;
    const screenCenter = containerW / 2;

    // Center of winning item within track
    // Track starts at translateX offset, item[WIN_IDX] left edge = WIN_IDX * CELL
    // Item center = WIN_IDX * CELL + ITEM_W/2
    const itemCenter = WIN_IDX * CELL + ITEM_W / 2;

    // We want itemCenter to land at screenCenter
    // translateX = screenCenter - itemCenter  (but we scroll negatively)
    const finalX = screenCenter - itemCenter;

    // Start further right so it spins left visually
    const startX = finalX + CELL * 18;

    track.style.transition = 'none';
    track.style.transform = `translateX(${startX}px)`;

    // Force reflow
    track.getBoundingClientRect();

    // Spin!
    track.style.transition = 'transform 7s cubic-bezier(0.02, 0.8, 0.2, 1)';
    track.style.transform = `translateX(${finalX}px)`;

    // Highlight winner
    setTimeout(() => {
      const items = track.querySelectorAll('.roulette-item');
      if (items[WIN_IDX]) {
        items[WIN_IDX].classList.add('winner');
        // Flash arrows gold
        arrowTop.style.filter = 'drop-shadow(0 0 16px #e8c96a) brightness(1.4)';
        arrowBottom.style.filter = 'drop-shadow(0 0 16px #e8c96a) brightness(1.4)';
      }
    }, 7050);

    setTimeout(() => {
      showResult(resultItem, resultKey, caseData);
    }, 7600);
  });
}

function showResult(item, itemKey, caseData) {
  const rs = RARITY_STYLE[item.rarity] || RARITY_STYLE.common;

  // Track ownership
  G.inventory[itemKey] = (G.inventory[itemKey] || 0) + 1;
  G.casesOpened = (G.casesOpened || 0) + 1;
  G.coins += Math.floor(item.value * 0.05); // small sell value reward
  saveG();
  refreshBalance();
  refreshStats();

  // Special effects for rare+
  if (['legendary','mythical','contraband'].includes(item.rarity)) {
    spawnFlash(rs.glow);
    spawnParticles();
  }

  const center = document.getElementById('openingCenter');
  center.innerHTML = '';

  // Result card
  const card = document.createElement('div');
  card.className = 'result-card ' + rs.bg;
  card.style.boxShadow = `0 0 60px ${rs.glow}, 0 20px 40px rgba(0,0,0,0.5)`;

  card.innerHTML = `
    <div class="result-emoji">${item.emoji}</div>
    <div class="result-name">${item.name}</div>
    <div class="result-rarity-badge ${rs.badge}">${rs.label}</div>
    <div class="result-desc">${item.desc}</div>
    <div class="result-value">$${item.value.toLocaleString()}</div>
    <div class="result-coins-earned">+$${Math.floor(item.value * 0.05)} BONUS</div>
  `;

  card.addEventListener('click', () => showItemDetail(item, itemKey));
  center.appendChild(card);

  const actions = document.createElement('div');
  actions.className = 'result-actions';

  const btnAgain = document.createElement('button');
  btnAgain.className = 'btn-again';
  btnAgain.textContent = 'OPEN AGAIN';
  btnAgain.addEventListener('click', () => {
    if (caseData.cost > 0 && G.coins < caseData.cost) {
      toast('âš  NOT ENOUGH COINS');
      return;
    }
    if (caseData.cost > 0) {
      G.coins -= caseData.cost;
      saveG();
      refreshBalance();
    }
    buildCaseReadyView(caseData);
  });

  const btnMenu = document.createElement('button');
  btnMenu.className = 'btn-menu';
  btnMenu.textContent = 'MENU';
  btnMenu.addEventListener('click', () => showScreen('screen-main'));

  actions.appendChild(btnAgain);
  actions.appendChild(btnMenu);
  center.appendChild(actions);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EFFECTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnFlash(color) {
  const f = document.createElement('div');
  f.className = 'shine-flash';
  f.style.background = `radial-gradient(ellipse at center, ${color} 0%, transparent 70%)`;
  document.body.appendChild(f);
  setTimeout(() => { try { document.body.removeChild(f); } catch(e){} }, 1200);
}

function spawnParticles() {
  const container = document.createElement('div');
  container.className = 'particles';
  document.body.appendChild(container);

  const colors = ['#c8a84b','#e8c96a','#ffffff','#e040e0','#4080e8'];
  for (let i = 0; i < 30; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = 4 + Math.random() * 6;
    const angle = Math.random() * Math.PI * 2;
    const dist = 100 + Math.random() * 200;
    p.style.cssText = `
      width:${size}px;height:${size}px;
      left:50%;top:50%;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      --tx:${Math.cos(angle)*dist}px;
      --ty:${Math.sin(angle)*dist}px;
      animation-delay:${Math.random()*0.3}s;
      animation-duration:${1+Math.random()*0.5}s;
    `;
    container.appendChild(p);
  }
  setTimeout(() => { try { document.body.removeChild(container); } catch(e){} }, 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INVENTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentFilter = 'all';

function renderInventory() {
  const grid = document.getElementById('invGrid');
  grid.innerHTML = '';

  const owned = Object.entries(G.inventory)
    .filter(([k, qty]) => qty > 0 && ITEMS[k])
    .filter(([k]) => currentFilter === 'all' || ITEMS[k].rarity === currentFilter)
    .sort(([ak],[bk]) => {
      const ai = RARITY_ORDER.indexOf(ITEMS[ak]?.rarity);
      const bi = RARITY_ORDER.indexOf(ITEMS[bk]?.rarity);
      return bi - ai;
    });

  if (owned.length === 0) {
    grid.innerHTML = `
      <div class="inv-empty">
        <div class="inv-empty-icon">ğŸ“¦</div>
        <div class="inv-empty-text">Nothing here yet</div>
      </div>
    `;
    return;
  }

  owned.forEach(([key, qty]) => {
    const item = ITEMS[key];
    const rs = RARITY_STYLE[item.rarity] || RARITY_STYLE.common;
    const card = document.createElement('div');
    card.className = 'inv-item ' + rs.bg;
    card.style.boxShadow = `0 2px 12px ${rs.glow}`;
    card.innerHTML = `
      <div class="inv-emoji">${item.emoji}</div>
      <div class="inv-name">${item.name}</div>
      <div class="inv-count">Ã—${qty}</div>
    `;
    card.addEventListener('click', () => showItemDetail(item, key));
    grid.appendChild(card);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ITEM DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showItemDetail(item, key) {
  const rs = RARITY_STYLE[item.rarity] || RARITY_STYLE.common;
  const card = document.getElementById('detailCard');
  card.className = 'detail-card ' + rs.bg;
  card.style.boxShadow = `0 0 60px ${rs.glow}, 0 20px 40px rgba(0,0,0,0.6)`;

  document.getElementById('detailEmoji').textContent = item.emoji;
  document.getElementById('detailName').textContent = item.name;
  document.getElementById('detailBadge').className = 'detail-rarity-badge ' + rs.badge;
  document.getElementById('detailBadge').textContent = rs.label;
  document.getElementById('detailDesc').textContent = item.desc;
  document.getElementById('detailValue').textContent = '$' + item.value.toLocaleString();
  const qty = G.inventory[key] || 0;
  document.getElementById('detailOwned').textContent = qty > 0 ? `Ã—${qty} OWNED` : 'NOT OWNED';

  document.getElementById('detailOverlay').classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CODE REDEMPTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function redeemCode() {
  const inp = document.getElementById('codeInput');
  const res = document.getElementById('codeResult');
  const code = inp.value.trim().toUpperCase();
  res.className = 'code-result';

  if (!code) return;
  if (usedCodes.has(code)) {
    res.className = 'code-result error';
    res.textContent = 'âš  CODE ALREADY USED';
    return;
  }
  const data = CODES_DB[code];
  if (!data) {
    res.className = 'code-result error';
    res.textContent = 'âš  INVALID CODE';
    return;
  }
  usedCodes.add(code);
  saveCodes();
  if (data.type === 'coins') {
    G.coins += data.amount;
    saveG();
    refreshBalance();
    res.className = 'code-result success';
    res.textContent = `âœ“ +$${data.amount.toLocaleString()} COINS ADDED`;
  }
  inp.value = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetGame() {
  if (!confirm('Reset all progress? This cannot be undone.')) return;
  G = { coins:150, inventory:{}, casesOpened:0, region:'all' };
  saveG();
  usedCodes.clear();
  saveCodes();
  refreshBalance();
  refreshStats();
  toast('GAME RESET');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT LISTENERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('btnOpenCase').addEventListener('click', () => {
  buildCaseList();
  openModal('modalCases');
});

document.getElementById('btnViewInventory').addEventListener('click', () => {
  renderInventory();
  showScreen('screen-inventory');
});

document.getElementById('btnCode').addEventListener('click', () => {
  document.getElementById('codeResult').className = 'code-result';
  document.getElementById('codeInput').value = '';
  openModal('modalCode');
});

document.getElementById('btnReset').addEventListener('click', resetGame);

document.getElementById('btnBackOpening').addEventListener('click', () => showScreen('screen-main'));
document.getElementById('btnBackInventory').addEventListener('click', () => {
  refreshStats();
  showScreen('screen-main');
});

document.getElementById('btnCloseCases').addEventListener('click', () => closeModal('modalCases'));
document.getElementById('btnCloseCode').addEventListener('click', () => closeModal('modalCode'));
document.getElementById('btnCloseDetail').addEventListener('click', () => closeModal('detailOverlay'));

document.getElementById('detailOverlay').addEventListener('click', e => {
  if (e.target === document.getElementById('detailOverlay')) closeModal('detailOverlay');
});

document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); });
});

document.getElementById('btnRedeem').addEventListener('click', redeemCode);
document.getElementById('codeInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') redeemCode();
});

// Inventory filters
document.getElementById('filterRow').addEventListener('click', e => {
  const chip = e.target.closest('.filter-chip');
  if (!chip) return;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  chip.classList.add('active');
  currentFilter = chip.dataset.filter;
  renderInventory();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
loadG();
refreshBalance();
refreshStats();
</script>

</body>
</html>
