<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PokÃ©mon Pack Opener</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --red:#cc0000;--red2:#e53935;--yellow:#ffd700;--yellow2:#ffb300;
  --blue:#1565c0;--blue2:#1e88e5;--purple:#7c3aed;--green:#16a34a;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
html,body{width:100%;height:100%;font-family:'Nunito',sans-serif;overflow:hidden;background:#1a0000;}

.screen{position:absolute;inset:0;display:none;flex-direction:column;align-items:center;overflow:hidden;}
.screen.active{display:flex;}

/* MAIN */
#screen-main{background:radial-gradient(ellipse at 50% 30%,#e53935 0%,#b71c1c 55%,#7f0000 100%);}
#screen-main::before{content:â€™â€™;position:absolute;inset:0;background:repeating-radial-gradient(circle at 50% 50%,transparent 0,transparent 30px,rgba(255,255,255,0.03) 30px,rgba(255,255,255,0.03) 31px);pointer-events:none;}
.main-topbar{width:100%;display:flex;align-items:center;justify-content:space-between;padding:14px 16px 0;position:relative;z-index:2;}
.btn-pill{display:flex;align-items:center;gap:6px;padding:8px 16px;border-radius:999px;border:none;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:14px;cursor:pointer;transition:transform 0.15s;}
.btn-pill:active{transform:scale(0.93);}
.btn-code{background:#fff;color:var(â€“blue);border:2.5px solid var(â€“blue2);}
.btn-news{background:#fff;color:var(â€“green);border:2.5px solid var(â€“green);}
.btn-coins{background:#fff;color:#1a1a1a;border:2.5px solid var(â€“yellow2);}
.main-hero{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;z-index:2;gap:8px;margin-top:-20px;}
.main-title{font-family:â€˜Bangersâ€™,cursive;font-size:72px;color:#fff;text-shadow:4px 4px 0 #7f0000,0 0 40px rgba(255,200,0,0.5);letter-spacing:4px;line-height:1;text-align:center;animation:titlePop 0.6s cubic-bezier(0.34,1.56,0.64,1) both;}
.main-subtitle{background:var(â€“yellow);color:var(â€“red);font-family:â€˜Bangersâ€™,cursive;font-size:22px;letter-spacing:3px;padding:8px 24px;border-radius:999px;box-shadow:0 3px 12px rgba(0,0,0,0.3);}
.main-pokeball{width:120px;height:120px;border-radius:50%;background:conic-gradient(#cc0000 0deg 180deg,#fff 180deg 360deg);border:6px solid #222;position:relative;box-shadow:0 6px 24px rgba(0,0,0,0.4);animation:spin 8s linear infinite;margin-bottom:8px;}
.main-pokeball::after{content:â€™â€™;position:absolute;inset:0;border-radius:50%;background:linear-gradient(180deg,rgba(255,255,255,0.15) 0%,transparent 60%);}
.main-pokeball::before{content:â€™â€™;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:32px;height:32px;border-radius:50%;background:#fff;border:5px solid #222;z-index:2;}
.main-buttons{width:100%;padding:0 20px 40px;display:flex;flex-direction:column;gap:12px;position:relative;z-index:2;}
.main-btn{width:100%;padding:18px;border-radius:16px;border:none;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:900;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;transition:transform 0.15s;box-shadow:0 4px 16px rgba(0,0,0,0.25);}
.main-btn:active{transform:scale(0.96) translateY(2px);}
.btn-shop{background:#fff;color:var(â€“red);}
.btn-index{background:#fff;color:var(â€“blue);border:3px solid var(â€“blue);}
.btn-reset{background:transparent;border:2.5px solid rgba(255,255,255,0.7);color:#fff;font-size:15px;padding:12px 24px;border-radius:999px;align-self:flex-end;width:auto;}

/* MODALS */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:100;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(3px);}
.modal-overlay.active{display:flex;}
.modal{width:100%;max-width:500px;background:#f5f5f5;border-radius:28px 28px 0 0;overflow:hidden;animation:slideUp 0.35s cubic-bezier(0.34,1.3,0.64,1) both;max-height:88vh;display:flex;flex-direction:column;}
.modal-header{background:var(â€“red2);color:#fff;padding:18px 20px;display:flex;align-items:center;gap:12px;flex-shrink:0;}
.modal-header h2{font-size:22px;font-weight:900;flex:1;}
.modal-coins-badge{background:rgba(0,0,0,0.25);border-radius:999px;padding:6px 14px;font-size:15px;font-weight:800;}
.modal-close{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.2);border:none;color:#fff;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0;}
.shop-tabs{display:flex;background:#fff;flex-shrink:0;border-bottom:1px solid #e0e0e0;}
.shop-tab{flex:1;padding:14px;text-align:center;font-weight:800;font-size:15px;cursor:pointer;border:none;background:none;color:#999;border-bottom:3px solid transparent;transition:all 0.2s;}
.shop-tab.active{color:var(â€“red);border-bottom-color:var(â€“red);}
.modal-body{overflow-y:auto;flex:1;padding:16px;}

/* PACK CARDS */
.section-header{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:900;margin-bottom:14px;margin-top:8px;}
.pack-card{background:#fff;border-radius:16px;padding:16px;display:flex;gap:14px;align-items:center;margin-bottom:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);border:2px solid transparent;transition:transform 0.15s;}
.pack-card:active{transform:scale(0.98);}
.pack-img{width:80px;height:110px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:36px;}
.pack-info{flex:1;min-width:0;}
.pack-name{font-size:17px;font-weight:900;margin-bottom:4px;}
.pack-desc{font-size:13px;color:#666;margin-bottom:10px;}
.pack-footer{display:flex;align-items:center;gap:10px;}
.price-free{color:var(â€“green);font-size:16px;font-weight:900;}
.price-cost{color:var(â€“purple);font-size:15px;font-weight:900;}
.btn-open{background:var(â€“red2);color:#fff;border:none;border-radius:999px;padding:10px 20px;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:14px;cursor:pointer;transition:transform 0.15s;white-space:nowrap;}
.btn-open:active{transform:scale(0.94);}
.pack-card.shiny-card{background:linear-gradient(135deg,#fef9c3,#fce7f3);border-color:var(â€“yellow2);}
.pack-card.limited-card{background:linear-gradient(135deg,#f3e8ff,#fce7f3);border-color:var(â€“purple);}
.badge{position:absolute;top:8px;right:8px;color:#fff;font-size:10px;font-weight:900;padding:3px 8px;border-radius:999px;z-index:1;}

/* INDEX */
.index-header{background:linear-gradient(135deg,#e53935,#ff7043);color:#fff;padding:20px;flex-shrink:0;}
.region-tabs{display:flex;gap:10px;padding:14px 16px;background:#f5f5f5;border-bottom:1px solid #ddd;flex-shrink:0;}
.region-tab{padding:10px 22px;border-radius:999px;font-weight:800;font-size:13px;cursor:pointer;border:none;background:#d7ccc8;color:#795548;transition:all 0.2s;}
.region-tab.active{background:var(â€“yellow);color:#7f3900;}
.dex-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:14px;}
.dex-card{aspect-ratio:1;border-radius:14px;background:#a1887f;display:flex;flex-direction:column;align-items:center;justify-content:center;color:rgba(255,255,255,0.4);font-weight:700;cursor:pointer;transition:transform 0.15s;position:relative;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.dex-card.owned,.dex-card.limited-owned{background:#fff;color:#333;}
.dex-card:active{transform:scale(0.93);}
.dex-emoji{font-size:26px;line-height:1;}
.dex-name{font-size:8px;font-weight:800;margin-top:2px;text-align:center;padding:0 2px;}
.dex-num{font-size:8px;color:#aaa;}
.dex-gem{font-size:13px;position:absolute;top:3px;right:3px;}

/* OPENING */
#screen-opening{background:radial-gradient(ellipse at 50% 40%,#1a237e 0%,#0d0d0d 100%);z-index:200;}
.opening-bg-stars{position:absolute;inset:0;pointer-events:none;overflow:hidden;}
.star{position:absolute;border-radius:50%;background:#fff;animation:twinkle 2s ease-in-out infinite;}
.opening-top{width:100%;padding:16px;display:flex;align-items:center;gap:12px;position:relative;z-index:2;flex-shrink:0;}
.btn-back{background:rgba(255,255,255,0.15);border:2px solid rgba(255,255,255,0.3);color:#fff;border-radius:999px;padding:8px 18px;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;cursor:pointer;font-size:14px;}
.opening-center{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;position:relative;z-index:2;padding:16px;overflow-y:auto;}
.pack-3d{width:140px;height:200px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:64px;cursor:pointer;box-shadow:0 12px 40px rgba(0,0,0,0.6),inset 0 2px 8px rgba(255,255,255,0.2);animation:packFloat 2.5s ease-in-out infinite;position:relative;overflow:hidden;flex-shrink:0;border:none;}
.pack-3d::before{content:â€™â€™;position:absolute;inset:0;border-radius:18px;background:linear-gradient(135deg,rgba(255,255,255,0.25) 0%,transparent 60%);}
.pack-3d:active{transform:scale(0.94) !important;animation:none;}
.tap-hint{color:rgba(255,255,255,0.7);font-size:15px;font-weight:700;animation:pulse 1.5s ease-in-out infinite;letter-spacing:1px;}
.reveal-grid{width:100%;max-width:400px;display:flex;gap:10px;justify-content:center;}
.reveal-card{flex:1;min-width:0;aspect-ratio:0.68;border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 4px;gap:3px;animation:cardFlip 0.5s cubic-bezier(0.34,1.4,0.64,1) both;box-shadow:0 6px 20px rgba(0,0,0,0.4);position:relative;overflow:hidden;cursor:pointer;border:none;}
.reveal-card::before{content:â€™â€™;position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.3) 0%,transparent 60%);}
.reveal-card:nth-child(1){animation-delay:0.1s;}
.reveal-card:nth-child(2){animation-delay:0.25s;}
.reveal-card:nth-child(3){animation-delay:0.4s;}
.reveal-card:active{transform:scale(0.95);}
.reveal-emoji{font-size:32px;position:relative;z-index:1;}
.reveal-name{font-size:10px;font-weight:900;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,0.5);text-align:center;position:relative;z-index:1;}
.reveal-type{font-size:8px;color:rgba(255,255,255,0.85);font-weight:700;background:rgba(0,0,0,0.25);padding:2px 5px;border-radius:99px;position:relative;z-index:1;}
.reveal-rarity-icon{position:absolute;top:5px;right:5px;font-size:12px;z-index:2;}
.reveal-coins{color:rgba(255,255,255,0.85);font-weight:800;font-size:15px;text-align:center;}
.reveal-actions{display:flex;gap:12px;margin-top:4px;}
.btn-again{background:var(â€“yellow);color:#7f3900;border:none;border-radius:999px;padding:14px 28px;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:900;font-size:16px;cursor:pointer;box-shadow:0 4px 16px rgba(255,200,0,0.4);}
.btn-again:active{transform:scale(0.94);}
.btn-home2{background:rgba(255,255,255,0.15);color:#fff;border:2px solid rgba(255,255,255,0.4);border-radius:999px;padding:14px 24px;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:800;font-size:15px;cursor:pointer;}

/* SHINY FLASH */
.shiny-flash{position:fixed;inset:0;background:radial-gradient(ellipse,rgba(255,255,255,0.7) 0%,transparent 70%);pointer-events:none;z-index:9999;animation:shinyFlash 1s ease-out forwards;}
@keyframes shinyFlash{0%{opacity:1;}100%{opacity:0;}}

/* CODE */
.code-input-wrap{padding:20px;}
.code-input-wrap p{margin-bottom:12px;color:#555;font-size:14px;font-weight:600;}
.code-input{width:100%;padding:14px;border-radius:12px;border:2px solid #ddd;font-family:â€˜Nunitoâ€™,sans-serif;font-size:16px;font-weight:700;text-transform:uppercase;letter-spacing:2px;outline:none;}
.code-input:focus{border-color:var(â€“blue2);}
.btn-redeem{width:100%;margin-top:12px;padding:14px;border-radius:12px;background:var(â€“blue);color:#fff;border:none;font-family:â€˜Nunitoâ€™,sans-serif;font-weight:900;font-size:16px;cursor:pointer;}
.code-result{padding:12px;border-radius:10px;font-weight:700;font-size:14px;margin-top:10px;display:none;}
.code-result.success{background:#dcfce7;color:#166534;display:block;}
.code-result.error{background:#fee2e2;color:#991b1b;display:block;}

/* DETAIL */
.poke-detail-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:500;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.poke-detail-overlay.active{display:flex;}
.poke-detail-card{width:85%;max-width:340px;border-radius:24px;padding:28px;display:flex;flex-direction:column;align-items:center;gap:12px;animation:titlePop 0.35s cubic-bezier(0.34,1.4,0.64,1) both;position:relative;}
.poke-detail-close{position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;border:none;background:rgba(0,0,0,0.2);color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:700;}
.poke-detail-emoji{font-size:80px;}
.poke-detail-name{font-family:â€˜Bangersâ€™,cursive;font-size:32px;letter-spacing:2px;color:#fff;}
.poke-detail-num{color:rgba(255,255,255,0.7);font-weight:700;}
.poke-detail-type{background:rgba(255,255,255,0.25);color:#fff;padding:6px 16px;border-radius:999px;font-weight:800;font-size:14px;}
.poke-detail-stats{width:100%;background:rgba(255,255,255,0.15);border-radius:14px;padding:14px;}
.stat-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.stat-row:last-child{margin-bottom:0;}
.stat-label{color:rgba(255,255,255,0.8);font-size:12px;font-weight:700;width:40px;}
.stat-bar{flex:1;height:8px;background:rgba(255,255,255,0.2);border-radius:4px;overflow:hidden;}
.stat-fill{height:100%;border-radius:4px;background:#fff;}
.stat-val{color:#fff;font-size:12px;font-weight:800;min-width:28px;text-align:right;}

/* TOAST */
.toast{position:fixed;top:24px;left:50%;transform:translateX(-50%) translateY(-80px);background:#222;color:#fff;padding:12px 24px;border-radius:999px;font-weight:800;font-size:14px;z-index:9999;transition:transform 0.4s cubic-bezier(0.34,1.4,0.64,1);white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.4);}
.toast.show{transform:translateX(-50%) translateY(0);}

/* ANIMATIONS */
@keyframes titlePop{from{opacity:0;transform:scale(0.7);}to{opacity:1;transform:scale(1);}}
@keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes packFloat{0%,100%{transform:translateY(0);}50%{transform:translateY(-14px);}}
@keyframes pulse{0%,100%{opacity:0.5;}50%{opacity:1;}}
@keyframes twinkle{0%,100%{opacity:0.2;}50%{opacity:1;}}
@keyframes cardFlip{from{opacity:0;transform:rotateY(90deg) scale(0.8);}to{opacity:1;transform:rotateY(0) scale(1);}}
</style>

</head>
<body>

<!-- MAIN MENU -->

<div class="screen active" id="screen-main">
  <div class="main-topbar">
    <div style="display:flex;gap:8px;">
      <button class="btn-pill btn-code" id="btnCode">&lt;/&gt; CODE</button>
      <button class="btn-pill btn-news" id="btnNews">ğŸ“° NEWS</button>
    </div>
    <button class="btn-pill btn-coins">ğŸª™ <span id="coinDisplay">$0</span></button>
  </div>
  <div class="main-hero">
    <div class="main-pokeball"></div>
    <div class="main-title">POKÃ‰MON</div>
    <div class="main-subtitle">PACK OPENER</div>
  </div>
  <div class="main-buttons">
    <button class="main-btn btn-shop" id="btnOpenShop">ğŸ›ï¸ SHOP</button>
    <button class="main-btn btn-index" id="btnOpenIndex">ğŸ“– INDEX</button>
    <button class="main-btn btn-reset" id="btnReset">ğŸ”„ RESET GAME</button>
  </div>
</div>

<!-- OPENING SCREEN -->

<div class="screen" id="screen-opening">
  <div class="opening-bg-stars" id="starsContainer"></div>
  <div class="opening-top">
    <button class="btn-back" id="btnBackOpening">â† Back</button>
    <span id="openingPackName" style="color:rgba(255,255,255,0.85);font-weight:800;font-size:15px;">Pack</span>
  </div>
  <div class="opening-center" id="openingCenter"></div>
</div>

<!-- SHOP MODAL -->

<div class="modal-overlay" id="modalShop">
  <div class="modal">
    <div class="modal-header">
      <span style="font-size:22px;">ğŸ›ï¸</span>
      <h2>PokÃ© Shop</h2>
      <div class="modal-coins-badge">ğŸª™ <span id="shopCoins">$0</span></div>
      <button class="modal-close" id="btnCloseShop">âœ•</button>
    </div>
    <div class="shop-tabs">
      <button class="shop-tab active" id="tabBtnPacks">PACKS</button>
      <button class="shop-tab" id="tabBtnItems">SHOP</button>
    </div>
    <div class="modal-body">
      <div id="tabPacks">
        <div class="section-header">ğŸ”´ Kanto</div>
        <div class="pack-card">
          <div class="pack-img" style="background:linear-gradient(135deg,#ff9800,#f44336);">ğŸ“¦</div>
          <div class="pack-info">
            <div class="pack-name">Kanto Pack</div>
            <div class="pack-desc">Contains 3 random Kanto PokÃ©mon</div>
            <div class="pack-footer">
              <span class="price-free">FREE</span>
              <button class="btn-open" data-pack="kanto">Open Pack</button>
            </div>
          </div>
        </div>
        <div class="pack-card shiny-card" style="position:relative;">
          <div class="badge" style="background:var(--yellow2);">NEW âœ¨</div>
          <div class="pack-img" style="background:linear-gradient(135deg,#a855f7,#ec4899);">â­</div>
          <div class="pack-info">
            <div class="pack-name" style="color:var(--purple);">Shiny Kanto Pack</div>
            <div class="pack-desc">Contains 3 random Shiny PokÃ©mon</div>
            <div class="pack-footer">
              <span class="price-cost">ğŸª™ $500</span>
              <button class="btn-open" data-pack="shiny-kanto">Open Pack</button>
            </div>
          </div>
        </div>
        <div class="section-header" style="margin-top:8px;">ğŸŸ¡ Johto</div>
        <div class="pack-card">
          <div class="pack-img" style="background:linear-gradient(135deg,#4db6ac,#26a69a);">ğŸŒ¿</div>
          <div class="pack-info">
            <div class="pack-name">Johto Pack</div>
            <div class="pack-desc">Contains 3 random Johto PokÃ©mon</div>
            <div class="pack-footer">
              <span class="price-cost">ğŸª™ $200</span>
              <button class="btn-open" data-pack="johto">Open Pack</button>
            </div>
          </div>
        </div>
        <div class="section-header" style="margin-top:8px;">ğŸ”µ Hoenn</div>
        <div class="pack-card">
          <div class="pack-img" style="background:linear-gradient(135deg,#42a5f5,#7e57c2);">ğŸŒŠ</div>
          <div class="pack-info">
            <div class="pack-name">Hoenn Pack</div>
            <div class="pack-desc">Contains 3 random Hoenn PokÃ©mon</div>
            <div class="pack-footer">
              <span class="price-cost">ğŸª™ $350</span>
              <button class="btn-open" data-pack="hoenn">Open Pack</button>
            </div>
          </div>
        </div>
        <div class="section-header" style="margin-top:8px;">ğŸ‘‘ Legendary</div>
        <div class="pack-card limited-card" style="position:relative;">
          <div class="badge" style="background:var(--purple);">ğŸ‰ LIMITED</div>
          <div class="pack-img" style="background:linear-gradient(135deg,#ffd700,#ff6b00);">âš¡</div>
          <div class="pack-info">
            <div class="pack-name" style="color:var(--purple);">Legendary Pack</div>
            <div class="pack-desc">Guaranteed rare or legendary PokÃ©mon!</div>
            <div class="pack-footer">
              <span class="price-cost">ğŸª™ $1000</span>
              <button class="btn-open" data-pack="legendary">Open Pack</button>
            </div>
          </div>
        </div>
      </div>
      <div id="tabItems" style="display:none;">
        <div class="section-header">ğŸ’ Limited Edition</div>
        <div class="pack-card limited-card" style="position:relative;">
          <div class="badge" style="background:var(--purple);">ğŸ‰ LIMITED</div>
          <div class="pack-img" style="background:linear-gradient(135deg,#c084fc,#f9a8d4);">ğŸ©</div>
          <div class="pack-info">
            <div class="pack-name" style="color:var(--purple);">New Year's Pikachu</div>
            <div class="pack-desc">Exclusive Edition â€¢ One-time purchase</div>
            <div class="pack-footer">
              <span class="price-cost">ğŸª™ $4500</span>
              <button class="btn-open" data-buy="newyear-pikachu" data-cost="4500">Buy</button>
            </div>
          </div>
        </div>
        <div class="pack-card limited-card" style="margin-top:4px;">
          <div class="pack-img" style="background:linear-gradient(135deg,#67e8f9,#818cf8);">â„ï¸</div>
          <div class="pack-info">
            <div class="pack-name" style="color:#1d4ed8;">Glaceon Special</div>
            <div class="pack-desc">Winter Edition â€¢ Limited Run</div>
            <div class="pack-footer">
              <span class="price-cost">ğŸª™ $3000</span>
              <button class="btn-open" data-buy="glaceon-special" data-cost="3000">Buy</button>
            </div>
          </div>
        </div>
        <div class="section-header" style="margin-top:8px;">ğŸ’¡ Earn Coins</div>
        <div style="background:#fff;border-radius:14px;padding:14px;font-size:13px;color:#555;font-weight:600;">
          Open packs to earn coins! Rarer PokÃ©mon earn more coins. Try codes for bonus coins!<br><br>
          <strong>Codes:</strong> FREECOIN Â· WELCOME Â· SHINYPACK
        </div>
      </div>
    </div>
  </div>
</div>

<!-- INDEX MODAL -->

<div class="modal-overlay" id="modalIndex">
  <div class="modal">
    <div class="index-header">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <h2 style="font-family:'Bangers',cursive;font-size:36px;letter-spacing:2px;">INDEX</h2>
        <div style="display:flex;align-items:center;gap:12px;">
          <span style="color:#ffd700;font-weight:900;font-size:18px;">ğŸª™ <span id="idxCoins">$0</span></span>
          <button class="modal-close" id="btnCloseIndex" style="background:rgba(255,255,255,0.2);">âœ•</button>
        </div>
      </div>
      <div class="region-tabs" id="regionTabs">
        <button class="region-tab active" data-region="kanto">KANTO</button>
        <button class="region-tab" data-region="johto">JOHTO</button>
        <button class="region-tab" data-region="hoenn">HOENN</button>
      </div>
    </div>
    <div class="modal-body" style="padding:0;background:linear-gradient(180deg,#ff7043,#e53935);">
      <div id="dexContent"></div>
    </div>
  </div>
</div>

<!-- CODE MODAL -->

<div class="modal-overlay" id="modalCode">
  <div class="modal">
    <div class="modal-header">
      <span style="font-size:22px;">&lt;/&gt;</span>
      <h2>Redeem Code</h2>
      <button class="modal-close" id="btnCloseCode">âœ•</button>
    </div>
    <div class="code-input-wrap">
      <p>Enter your promo code to get free coins!</p>
      <input type="text" class="code-input" id="codeInput" placeholder="ENTER CODE" maxlength="20">
      <button class="btn-redeem" id="btnRedeem">REDEEM</button>
      <div class="code-result" id="codeResult"></div>
    </div>
  </div>
</div>

<!-- POKEMON DETAIL -->

<div class="poke-detail-overlay" id="pokeDetail">
  <div class="poke-detail-card" id="pokeDetailCard">
    <button class="poke-detail-close" id="btnCloseDetail">âœ•</button>
    <div class="poke-detail-emoji" id="detailEmoji">â“</div>
    <div class="poke-detail-name" id="detailName">POKEMON</div>
    <div class="poke-detail-num" id="detailNum">#000</div>
    <div class="poke-detail-type" id="detailType">Normal</div>
    <div class="poke-detail-stats">
      <div class="stat-row"><span class="stat-label">HP</span><div class="stat-bar"><div class="stat-fill" id="statHp"></div></div><span class="stat-val" id="svalHp">0</span></div>
      <div class="stat-row"><span class="stat-label">ATK</span><div class="stat-bar"><div class="stat-fill" id="statAtk"></div></div><span class="stat-val" id="svalAtk">0</span></div>
      <div class="stat-row"><span class="stat-label">DEF</span><div class="stat-bar"><div class="stat-fill" id="statDef"></div></div><span class="stat-val" id="svalDef">0</span></div>
      <div class="stat-row"><span class="stat-label">SPD</span><div class="stat-bar"><div class="stat-fill" id="statSpd"></div></div><span class="stat-val" id="svalSpd">0</span></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POKEMON DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DB = {
  kanto:[
    {id:1,  name:'Bulbasaur', emoji:'ğŸŒ¿',type:'Grass/Poison',rarity:'common',   color:['#4caf50','#81c784'],hp:45, atk:49, def:49, spd:45},
    {id:4,  name:'Charmander',emoji:'ğŸ”¥',type:'Fire',        rarity:'common',   color:['#ff5722','#ff7043'],hp:39, atk:52, def:43, spd:65},
    {id:7,  name:'Squirtle',  emoji:'ğŸ’§',type:'Water',       rarity:'common',   color:['#2196f3','#64b5f6'],hp:44, atk:48, def:65, spd:43},
    {id:25, name:'Pikachu',   emoji:'âš¡',type:'Electric',    rarity:'uncommon', color:['#ffd700','#ffb300'],hp:35, atk:55, def:30, spd:90},
    {id:39, name:'Jigglypuff',emoji:'ğŸ¤',type:'Normal/Fairy',rarity:'common',   color:['#f48fb1','#f06292'],hp:115,atk:45, def:20, spd:20},
    {id:52, name:'Meowth',    emoji:'ğŸ±',type:'Normal',      rarity:'common',   color:['#bdbdbd','#9e9e9e'],hp:40, atk:45, def:35, spd:90},
    {id:54, name:'Psyduck',   emoji:'ğŸ¦†',type:'Water',       rarity:'common',   color:['#fdd835','#f9a825'],hp:50, atk:52, def:48, spd:55},
    {id:63, name:'Abra',      emoji:'ğŸ”®',type:'Psychic',     rarity:'uncommon', color:['#9c27b0','#ba68c8'],hp:25, atk:20, def:15, spd:90},
    {id:94, name:'Gengar',    emoji:'ğŸ‘»',type:'Ghost/Poison',rarity:'rare',     color:['#673ab7','#9575cd'],hp:60, atk:65, def:60, spd:110},
    {id:131,name:'Lapras',    emoji:'ğŸ‹',type:'Water/Ice',   rarity:'rare',     color:['#80cbc4','#4db6ac'],hp:130,atk:85, def:80, spd:60},
    {id:133,name:'Eevee',     emoji:'ğŸ¦Š',type:'Normal',      rarity:'uncommon', color:['#a1887f','#8d6e63'],hp:55, atk:55, def:50, spd:55},
    {id:143,name:'Snorlax',   emoji:'ğŸ˜´',type:'Normal',      rarity:'rare',     color:['#546e7a','#78909c'],hp:160,atk:110,def:65, spd:30},
    {id:147,name:'Dratini',   emoji:'ğŸ‰',type:'Dragon',      rarity:'rare',     color:['#3f51b5','#7986cb'],hp:41, atk:64, def:45, spd:50},
    {id:149,name:'Dragonite', emoji:'ğŸ²',type:'Dragon/Fly',  rarity:'legendary',color:['#ff6f00','#ffa000'],hp:91, atk:134,def:95, spd:80},
    {id:150,name:'Mewtwo',    emoji:'ğŸ§¬',type:'Psychic',     rarity:'legendary',color:['#7b1fa2','#ab47bc'],hp:106,atk:110,def:90, spd:130},
    {id:151,name:'Mew',       emoji:'ğŸŒ¸',type:'Psychic',     rarity:'legendary',color:['#f06292','#e91e63'],hp:100,atk:100,def:100,spd:100},
  ],
  johto:[
    {id:152,name:'Chikorita', emoji:'ğŸƒ',type:'Grass',       rarity:'common',   color:['#66bb6a','#43a047'],hp:45, atk:49, def:65, spd:45},
    {id:155,name:'Cyndaquil', emoji:'ğŸ”¥',type:'Fire',        rarity:'common',   color:['#ef6c00','#e65100'],hp:39, atk:52, def:43, spd:65},
    {id:158,name:'Totodile',  emoji:'ğŸŠ',type:'Water',       rarity:'common',   color:['#0288d1','#01579b'],hp:50, atk:65, def:64, spd:43},
    {id:175,name:'Togepi',    emoji:'ğŸ¥š',type:'Fairy',       rarity:'uncommon', color:['#fff9c4','#ffe082'],hp:35, atk:20, def:65, spd:20},
    {id:179,name:'Mareep',    emoji:'ğŸ‘',type:'Electric',    rarity:'common',   color:['#fff176','#ffee58'],hp:55, atk:40, def:40, spd:35},
    {id:196,name:'Espeon',    emoji:'â˜€ï¸',type:'Psychic',     rarity:'rare',     color:['#ce93d8','#ab47bc'],hp:65, atk:65, def:60, spd:110},
    {id:197,name:'Umbreon',   emoji:'ğŸŒ™',type:'Dark',        rarity:'rare',     color:['#37474f','#263238'],hp:95, atk:65, def:110,spd:65},
    {id:245,name:'Suicune',   emoji:'ğŸ’™',type:'Water',       rarity:'legendary',color:['#0097a7','#00838f'],hp:100,atk:75, def:115,spd:85},
    {id:249,name:'Lugia',     emoji:'ğŸŒŠ',type:'Psychic/Fly', rarity:'legendary',color:['#b0bec5','#90a4ae'],hp:106,atk:90, def:130,spd:110},
    {id:250,name:'Ho-Oh',     emoji:'ğŸ¦…',type:'Fire/Flying', rarity:'legendary',color:['#f44336','#ef5350'],hp:106,atk:130,def:90, spd:90},
    {id:251,name:'Celebi',    emoji:'ğŸŒ€',type:'Psychic/Grass',rarity:'legendary',color:['#69f0ae','#00e676'],hp:100,atk:100,def:100,spd:100},
  ],
  hoenn:[
    {id:252,name:'Treecko',   emoji:'ğŸ¦',type:'Grass',       rarity:'common',   color:['#4caf50','#388e3c'],hp:40, atk:45, def:35, spd:70},
    {id:255,name:'Torchic',   emoji:'ğŸ£',type:'Fire',        rarity:'common',   color:['#ff7043','#f4511e'],hp:45, atk:60, def:40, spd:45},
    {id:258,name:'Mudkip',    emoji:'ğŸ’¦',type:'Water',       rarity:'common',   color:['#2196f3','#1976d2'],hp:50, atk:70, def:50, spd:40},
    {id:280,name:'Ralts',     emoji:'ğŸ¤',type:'Psychic/Fairy',rarity:'uncommon',color:['#f8bbd0','#f48fb1'],hp:28, atk:25, def:25, spd:40},
    {id:302,name:'Sableye',   emoji:'ğŸ’œ',type:'Dark/Ghost',  rarity:'rare',     color:['#512da8','#673ab7'],hp:50, atk:75, def:75, spd:50},
    {id:350,name:'Milotic',   emoji:'ğŸ ',type:'Water',       rarity:'rare',     color:['#80deea','#4dd0e1'],hp:95, atk:60, def:79, spd:81},
    {id:359,name:'Absol',     emoji:'ğŸŒ‘',type:'Dark',        rarity:'rare',     color:['#37474f','#455a64'],hp:65, atk:130,def:60, spd:75},
    {id:373,name:'Salamence', emoji:'ğŸ¦•',type:'Dragon/Fly',  rarity:'legendary',color:['#1565c0','#1976d2'],hp:95, atk:135,def:80, spd:100},
    {id:376,name:'Metagross', emoji:'ğŸ¤–',type:'Steel/Psychic',rarity:'legendary',color:['#455a64','#546e7a'],hp:80, atk:135,def:130,spd:70},
    {id:384,name:'Rayquaza',  emoji:'ğŸŒªï¸',type:'Dragon/Fly',  rarity:'legendary',color:['#1b5e20','#2e7d32'],hp:105,atk:150,def:90, spd:95},
    {id:385,name:'Jirachi',   emoji:'â­',type:'Steel/Psychic',rarity:'legendary',color:['#ffd54f','#ffca28'],hp:100,atk:100,def:100,spd:100},
  ],
};

const SHINY_POOL = [
  {id:25, name:'âœ¨ Pikachu',   emoji:'ğŸŒŸ',type:'Electric',    rarity:'shiny',color:['#fffde7','#ffe082'],hp:35, atk:55, def:30, spd:90},
  {id:94, name:'âœ¨ Gengar',    emoji:'ğŸ’«',type:'Ghost/Poison',rarity:'shiny',color:['#e1bee7','#ce93d8'],hp:60, atk:65, def:60, spd:110},
  {id:6,  name:'âœ¨ Charizard', emoji:'ğŸŒˆ',type:'Fire/Flying', rarity:'shiny',color:['#111','#333'],      hp:78, atk:84, def:78, spd:100},
  {id:150,name:'âœ¨ Mewtwo',    emoji:'ğŸ’ ',type:'Psychic',     rarity:'shiny',color:['#81d4fa','#4fc3f7'],hp:106,atk:110,def:90, spd:130},
  {id:149,name:'âœ¨ Dragonite', emoji:'ğŸ”…',type:'Dragon/Fly',  rarity:'shiny',color:['#c5e1a5','#aed581'],hp:91, atk:134,def:95, spd:80},
  {id:131,name:'âœ¨ Lapras',    emoji:'ğŸ©µ',type:'Water/Ice',   rarity:'shiny',color:['#b3e5fc','#81d4fa'],hp:130,atk:85, def:80, spd:60},
];

const LIMITED_DB = {
  'newyear-pikachu':{id:800,name:"New Year's Pikachu",emoji:'ğŸ©',type:'Electric',rarity:'limited',color:['#9c27b0','#f48fb1'],hp:35,atk:55,def:30,spd:90},
  'glaceon-special': {id:801,name:'Glaceon Special',   emoji:'â„ï¸',type:'Ice',     rarity:'limited',color:['#4fc3f7','#81d4fa'],hp:65,atk:60,def:110,spd:65},
};

const PACKS = {
  'kanto':      {pool:()=>[...DB.kanto],                    cost:0,    emoji:'ğŸ“¦',g:['#ff9800','#f44336']},
  'johto':      {pool:()=>[...DB.johto],                    cost:200,  emoji:'ğŸŒ¿',g:['#4db6ac','#26a69a']},
  'hoenn':      {pool:()=>[...DB.hoenn],                    cost:350,  emoji:'ğŸŒŠ',g:['#42a5f5','#7e57c2']},
  'shiny-kanto':{pool:()=>[...SHINY_POOL],                  cost:500,  emoji:'â­',g:['#a855f7','#ec4899']},
  'legendary':  {pool:()=>[...DB.kanto,...DB.johto,...DB.hoenn].filter(p=>p.rarity==='legendary'),cost:1000,emoji:'âš¡',g:['#ffd700','#ff6b00']},
};

const RARITY_COLORS = {
  common:   ['#757575','#9e9e9e'],
  uncommon: ['#4caf50','#81c784'],
  rare:     ['#2196f3','#64b5f6'],
  legendary:['#ff9800','#ffd54f'],
  shiny:    ['#9c27b0','#e1bee7'],
  limited:  ['#6d28d9','#c084fc'],
};
const RARITY_COINS  = {common:10,uncommon:30,rare:100,legendary:400,shiny:250,limited:0};
const RARITY_W      = {legendary:1,shiny:2,rare:5,uncommon:12,common:20};
const RARITY_ICONS  = {legendary:'â­',rare:'ğŸ’',shiny:'âœ¨',uncommon:'ğŸŸ¢',limited:'ğŸ’'};

const CODES_DB = {
  'FREECOIN' :{type:'coins',amount:500},
  'WELCOME'  :{type:'coins',amount:250},
  'SHINYPACK':{type:'coins',amount:1000},
  'POKE500'  :{type:'coins',amount:500},
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let G = {coins:0, owned:{}, region:'kanto'};
let activePack = null; // key of current pack being opened

function saveG(){ try{localStorage.setItem('poke3',JSON.stringify(G));}catch(e){} }
function loadG(){ try{const s=localStorage.getItem('poke3');if(s)G=JSON.parse(s);}catch(e){} }

const usedCodes = new Set();
try{JSON.parse(localStorage.getItem('poke3codes')||'[]').forEach(c=>usedCodes.add(c));}catch(e){}
function saveUsedCodes(){try{localStorage.setItem('poke3codes',JSON.stringify([...usedCodes]));}catch(e){}}

function makeKey(name){ return name.replace(/[^a-z0-9]/gi,'').toLowerCase(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function refreshCoins(){
  const f='$'+G.coins.toLocaleString();
  document.getElementById('coinDisplay').textContent=f;
  document.getElementById('shopCoins').textContent=f;
  document.getElementById('idxCoins').textContent=f;
}

let toastTmr=null;
function toast(msg){
  clearTimeout(toastTmr);
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  toastTmr=setTimeout(()=>el.classList.remove('show'),2500);
}

function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function openModal(id){
  document.getElementById(id).classList.add('active');
  refreshCoins();
  if(id==='modalIndex') renderDex(G.region);
}
function closeModal(id){ document.getElementById(id).classList.remove('active'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PACK LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function weightedDraw(pool){
  // Draw without replacement
  const arr=[...pool];
  const drawn=[];
  for(let i=0;i<3;i++){
    if(!arr.length) break;
    const total=arr.reduce((s,p)=>s+(RARITY_W[p.rarity]||10),0);
    let r=Math.random()*total;
    let idx=0;
    for(;idx<arr.length;idx++){ r-=(RARITY_W[arr[idx].rarity]||10); if(r<=0) break; }
    idx=Math.min(idx,arr.length-1);
    drawn.push(arr.splice(idx,1)[0]);
  }
  // Pad if needed
  while(drawn.length<3) drawn.push({...drawn[drawn.length-1]});
  return drawn;
}

function startPack(packKey){
  const pd=PACKS[packKey];
  if(!pd){ toast('âŒ Pack not found!'); return; }
  if(pd.cost>0&&G.coins<pd.cost){ toast('ğŸª™ Not enough coins! Need $'+pd.cost.toLocaleString()); return; }
  if(pd.cost>0){ G.coins-=pd.cost; saveG(); refreshCoins(); }

  activePack=packKey;
  closeModal('modalShop');
  showScreen('screen-opening');

  document.getElementById('openingPackName').textContent =
    packKey.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase())+' Pack';

  buildPackVisual(pd);
  generateStars();
}

function buildPackVisual(pd){
  const center=document.getElementById('openingCenter');
  center.innerHTML='';

  const packBtn=document.createElement('button');
  packBtn.className='pack-3d';
  packBtn.textContent=pd.emoji;
  packBtn.style.background=`linear-gradient(135deg,${pd.g[0]},${pd.g[1]})`;
  packBtn.addEventListener('click',doReveal,{once:true}); // once:true prevents double-tap bugs

  const hint=document.createElement('div');
  hint.className='tap-hint';
  hint.textContent='TAP TO OPEN!';

  center.appendChild(packBtn);
  center.appendChild(hint);
}

function doReveal(){
  const pd=PACKS[activePack];
  if(!pd) return;

  const pool=pd.pool();
  if(!pool||pool.length===0){ toast('âŒ Empty pool!'); return; }

  const drawn=weightedDraw(pool);

  // Track ownership & earnings
  let coins=0, special=false;
  drawn.forEach(p=>{
    const k=makeKey(p.name);
    G.owned[k]=(G.owned[k]||0)+1;
    coins+=RARITY_COINS[p.rarity]||10;
    if(p.rarity==='shiny'||p.rarity==='legendary') special=true;
  });
  G.coins+=coins;
  saveG();
  refreshCoins();

  if(special){
    const flash=document.createElement('div');
    flash.className='shiny-flash';
    document.body.appendChild(flash);
    setTimeout(()=>{ try{document.body.removeChild(flash);}catch(e){} },1000);
  }

  const center=document.getElementById('openingCenter');
  center.innerHTML='';

  const earnedEl=document.createElement('div');
  earnedEl.className='reveal-coins';
  earnedEl.textContent='+ğŸª™ $'+coins+' earned!';
  center.appendChild(earnedEl);

  const grid=document.createElement('div');
  grid.className='reveal-grid';

  drawn.forEach(p=>{
    const [c1,c2]=p.color||RARITY_COLORS[p.rarity]||['#666','#999'];
    const icon=RARITY_ICONS[p.rarity]||'';

    const card=document.createElement('button');
    card.className='reveal-card';
    card.style.background=`linear-gradient(160deg,${c1},${c2})`;
    card.innerHTML=`
      ${icon?`<div class="reveal-rarity-icon">${icon}</div>`:''}
      <div class="reveal-emoji">${p.emoji}</div>
      <div class="reveal-name">${p.name}</div>
      <div class="reveal-type">${p.type}</div>
    `;
    // Store reference to pokemon object safely in JS closure
    card.addEventListener('click',(()=>{
      const pokemon=p; // captured in closure
      return ()=>showDetail(pokemon);
    })());
    grid.appendChild(card);
  });

  center.appendChild(grid);

  const actions=document.createElement('div');
  actions.className='reveal-actions';

  const btnAgain=document.createElement('button');
  btnAgain.className='btn-again';
  btnAgain.textContent='Open Again';
  btnAgain.addEventListener('click',()=>startPack(activePack));

  const btnHome=document.createElement('button');
  btnHome.className='btn-home2';
  btnHome.textContent='â† Home';
  btnHome.addEventListener('click',()=>showScreen('screen-main'));

  actions.appendChild(btnAgain);
  actions.appendChild(btnHome);
  center.appendChild(actions);
}

function generateStars(){
  const c=document.getElementById('starsContainer');
  c.innerHTML='';
  for(let i=0;i<60;i++){
    const s=document.createElement('div');
    s.className='star';
    s.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;`+
      `animation-delay:${Math.random()*3}s;animation-duration:${1.5+Math.random()*2}s;`+
      `width:${1+Math.random()*3}px;height:${1+Math.random()*3}px;`;
    c.appendChild(s);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUY LIMITED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buyLimited(key,cost){
  if(G.owned[key]>0){ toast('âœ… Already owned!'); return; }
  if(G.coins<cost){ toast('ğŸª™ Not enough coins! Need $'+cost.toLocaleString()); return; }
  G.coins-=cost;
  G.owned[key]=(G.owned[key]||0)+1;
  saveG(); refreshCoins();
  toast('ğŸ‰ Purchased! Check your Index!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDEX / POKÃ‰DEX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDex(region){
  const pool=DB[region]||[];
  const ownedCount=pool.filter(p=>G.owned[makeKey(p.name)]>0).length;
  const el=document.getElementById('dexContent');
  const frag=document.createDocumentFragment();

  // Limited section (kanto only)
  if(region==='kanto'){
    const section=document.createElement('div');
    section.style.cssText='padding:14px 14px 0;';
    const hdr=document.createElement('div');
    hdr.style.cssText='display:flex;align-items:center;gap:8px;font-size:16px;font-weight:900;color:#fff;margin-bottom:10px;';
    hdr.textContent='ğŸ’ Limited';
    const dgrid=document.createElement('div');
    dgrid.className='dex-grid';
    dgrid.style.cssText='padding:0;margin-bottom:4px;';
    Object.entries(LIMITED_DB).forEach(([key,p])=>{
      const isOwned=(G.owned[key]||0)>0;
      const card=document.createElement('div');
      card.className='dex-card'+(isOwned?' limited-owned':'');
      if(isOwned){
        const [c1,c2]=p.color;
        card.style.background=`linear-gradient(135deg,${c1}44,${c2}44)`;
        card.style.border=`2px solid ${c1}88`;
        card.innerHTML=`<div class="dex-gem">ğŸ’</div><div class="dex-emoji">${p.emoji}</div><div class="dex-name">${p.name}</div>`;
        card.addEventListener('click',()=>showDetail(p));
      } else {
        card.innerHTML='<div style="font-size:20px;color:rgba(255,255,255,0.2);">ğŸ’</div>';
      }
      dgrid.appendChild(card);
    });
    section.appendChild(hdr);
    section.appendChild(dgrid);
    frag.appendChild(section);
  }

  // Regular section
  const section2=document.createElement('div');
  section2.style.cssText='padding:14px;';
  const hdr2=document.createElement('div');
  hdr2.style.cssText='display:flex;align-items:center;gap:8px;font-size:16px;font-weight:900;color:#fff;margin-bottom:10px;';
  const regionIcon={kanto:'ğŸ”´',johto:'ğŸŸ¡',hoenn:'ğŸ”µ'}[region]||'âšª';
  hdr2.innerHTML=`${regionIcon} ${region.charAt(0).toUpperCase()+region.slice(1)} <span style="font-size:12px;color:rgba(255,255,255,0.6);font-weight:700;margin-left:auto;">${ownedCount}/${pool.length}</span>`;
  const dgrid2=document.createElement('div');
  dgrid2.className='dex-grid';
  dgrid2.style.cssText='padding:0;';

  pool.forEach(p=>{
    const key=makeKey(p.name);
    const isOwned=(G.owned[key]||0)>0;
    const card=document.createElement('div');
    card.className='dex-card'+(isOwned?' owned':'');
    if(isOwned){
      const [c1,c2]=p.color||['#ccc','#aaa'];
      card.style.background=`linear-gradient(135deg,${c1}33,${c2}33)`;
      card.style.border=`2px solid ${c1}77`;
      const icon=RARITY_ICONS[p.rarity]||'';
      card.innerHTML=`${icon?`<div class="dex-gem">${icon}</div>`:''}<div class="dex-emoji">${p.emoji}</div><div class="dex-name">${p.name}</div><div class="dex-num">#${p.id}</div>`;
      card.addEventListener('click',()=>showDetail(p));
    } else {
      card.innerHTML=`<div style="color:rgba(255,255,255,0.3);font-size:11px;font-weight:700;">#${p.id}</div>`;
    }
    dgrid2.appendChild(card);
  });

  section2.appendChild(hdr2);
  section2.appendChild(dgrid2);
  frag.appendChild(section2);

  el.innerHTML='';
  el.appendChild(frag);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POKEMON DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showDetail(p){
  if(!p) return;
  const [c1,c2]=p.color||RARITY_COLORS[p.rarity]||['#555','#777'];
  document.getElementById('pokeDetailCard').style.background=`linear-gradient(160deg,${c1},${c2})`;
  document.getElementById('detailEmoji').textContent=p.emoji||'â“';
  document.getElementById('detailName').textContent=(p.name||'???').toUpperCase();
  document.getElementById('detailNum').textContent=p.id?'#'+p.id:'';
  document.getElementById('detailType').textContent=p.type||'Unknown';
  const hp=p.hp||50,atk=p.atk||50,def=p.def||50,spd=p.spd||50;
  document.getElementById('statHp').style.width =Math.min(hp /200*100,100)+'%';
  document.getElementById('statAtk').style.width=Math.min(atk/200*100,100)+'%';
  document.getElementById('statDef').style.width=Math.min(def/200*100,100)+'%';
  document.getElementById('statSpd').style.width=Math.min(spd/200*100,100)+'%';
  document.getElementById('svalHp').textContent =hp;
  document.getElementById('svalAtk').textContent=atk;
  document.getElementById('svalDef').textContent=def;
  document.getElementById('svalSpd').textContent=spd;
  document.getElementById('pokeDetail').classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CODE REDEMPTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function redeemCode(){
  const inp=document.getElementById('codeInput');
  const res=document.getElementById('codeResult');
  const code=inp.value.trim().toUpperCase();
  res.className='code-result';
  if(!code) return;
  if(usedCodes.has(code)){
    res.className='code-result error'; res.textContent='âŒ Code already used!'; return;
  }
  const data=CODES_DB[code];
  if(!data){
    res.className='code-result error'; res.textContent='âŒ Invalid code!'; return;
  }
  usedCodes.add(code); saveUsedCodes();
  if(data.type==='coins'){
    G.coins+=data.amount; saveG(); refreshCoins();
    res.className='code-result success'; res.textContent=`âœ… +ğŸª™ $${data.amount} coins added!`;
  }
  inp.value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetGame(){
  if(!confirm('Reset all progress? Cannot be undone!')) return;
  G={coins:0,owned:{},region:'kanto'};
  saveG();
  usedCodes.clear(); saveUsedCodes();
  refreshCoins();
  toast('ğŸ”„ Game reset!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT LISTENERS â€” all in JS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Main menu
document.getElementById('btnCode').addEventListener('click',()=>openModal('modalCode'));
document.getElementById('btnNews').addEventListener('click',()=>toast('ğŸ“° No new news today!'));
document.getElementById('btnOpenShop').addEventListener('click',()=>openModal('modalShop'));
document.getElementById('btnOpenIndex').addEventListener('click',()=>openModal('modalIndex'));
document.getElementById('btnReset').addEventListener('click',resetGame);
document.getElementById('btnBackOpening').addEventListener('click',()=>showScreen('screen-main'));

// Close buttons
document.getElementById('btnCloseShop').addEventListener('click',()=>closeModal('modalShop'));
document.getElementById('btnCloseIndex').addEventListener('click',()=>closeModal('modalIndex'));
document.getElementById('btnCloseCode').addEventListener('click',()=>closeModal('modalCode'));
document.getElementById('btnCloseDetail').addEventListener('click',()=>document.getElementById('pokeDetail').classList.remove('active'));

// Shop tabs
document.getElementById('tabBtnPacks').addEventListener('click',function(){
  this.classList.add('active');
  document.getElementById('tabBtnItems').classList.remove('active');
  document.getElementById('tabPacks').style.display='block';
  document.getElementById('tabItems').style.display='none';
});
document.getElementById('tabBtnItems').addEventListener('click',function(){
  this.classList.add('active');
  document.getElementById('tabBtnPacks').classList.remove('active');
  document.getElementById('tabPacks').style.display='none';
  document.getElementById('tabItems').style.display='block';
});

// Shop pack/buy buttons â€” event delegation, no inline JS
document.getElementById('modalShop').addEventListener('click',function(e){
  const btn=e.target.closest('.btn-open');
  if(!btn) return;
  if(btn.dataset.pack){
    startPack(btn.dataset.pack);
  } else if(btn.dataset.buy){
    buyLimited(btn.dataset.buy, parseInt(btn.dataset.cost,10));
  }
});

// Region tabs in index
document.getElementById('regionTabs').addEventListener('click',function(e){
  const btn=e.target.closest('.region-tab');
  if(!btn) return;
  document.querySelectorAll('.region-tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
  G.region=btn.dataset.region;
  renderDex(G.region);
});

// Code enter key
document.getElementById('codeInput').addEventListener('keydown',e=>{ if(e.key==='Enter') redeemCode(); });
document.getElementById('btnRedeem').addEventListener('click',redeemCode);

// Close modals on backdrop click
document.querySelectorAll('.modal-overlay').forEach(o=>{
  o.addEventListener('click',e=>{ if(e.target===o) o.classList.remove('active'); });
});
document.getElementById('pokeDetail').addEventListener('click',e=>{
  if(e.target===document.getElementById('pokeDetail')) document.getElementById('pokeDetail').classList.remove('active');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
loadG();
refreshCoins();
</script>

</body>
</html>
